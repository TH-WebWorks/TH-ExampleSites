<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website Consultation Wizard - Professional consultation for T&H WebWorks">
    <meta name="robots" content="noindex, nofollow">
    <title>Website Consultation Wizard - T&H WebWorks</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* === MODERN DESIGN SYSTEM === */
        :root {
            --primary: #3abbfa;
            --primary-dark: #2a9ee0;
            --primary-light: #5ac8ff;
            --secondary: #f39c12;
            --accent: #2ecc71;
            --dark: #1b1e24;
            --dark-light: #2b2f35;
            --dark-lighter: #3a3f47;
            --text: #ffffff;
            --text-muted: #a0a0a0;
            --border: #4a4f57;
            --success: #27ae60;
            --warning: #f39c12;
            --error: #e74c3c;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* === AUTH OVERLAY === */
        .auth-overlay {
            background: linear-gradient(135deg, var(--dark) 0%, #2d3748 100%);
            backdrop-filter: blur(10px);
        }

        .auth-card {
            background: rgba(43, 47, 53, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-xl);
            border-radius: var(--radius-xl);
        }

        .auth-input {
            background: rgba(26, 30, 36, 0.8);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            transition: all 0.3s ease;
            font-size: 1.5rem;
            letter-spacing: 0.5rem;
        }

        .auth-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(58, 187, 250, 0.1);
            transform: translateY(-2px);
        }

        .auth-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius);
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .auth-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .auth-btn:hover::before {
            left: 100%;
        }

        /* === MAIN LAYOUT === */
        .main-container {
            background: linear-gradient(135deg, var(--dark) 0%, #2d3748 100%);
            min-height: 100vh;
        }

        .form-panel {
            background: rgba(43, 47, 53, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
        }

        .preview-panel {
            background: rgba(26, 30, 36, 0.8);
            backdrop-filter: blur(10px);
            border-left: 1px solid var(--border);
        }

        /* === PROGRESS BAR === */
        .progress-container {
            background: rgba(26, 30, 36, 0.8);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        /* === FORM ELEMENTS === */
        .form-step {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-step.active {
            opacity: 1;
            transform: translateY(0);
        }

        .step-title {
            font-size: 1.875rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .step-description {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.75rem;
            display: block;
            font-size: 1.1rem;
        }

        .form-description {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        /* === INPUT STYLES === */
        .input-group {
            display: grid;
            gap: 1rem;
        }

        .input-group.grid-cols-1 {
            grid-template-columns: 1fr;
        }

        .input-group.grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .input-group.md\\:grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        @media (max-width: 768px) {
            .input-group.grid-cols-2,
            .input-group.md\\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
        }

        .input-option {
            background: rgba(26, 30, 36, 0.8);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .input-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .input-option.selected {
            border-color: var(--primary);
            background: rgba(58, 187, 250, 0.1);
            box-shadow: 0 0 0 3px rgba(58, 187, 250, 0.1);
        }

        .input-option input[type="radio"],
        .input-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

        .input-option input[type="text"],
        .input-option input[type="email"],
        .input-option input[type="tel"],
        .input-option select,
        .input-option textarea {
            background: transparent;
            border: none;
            outline: none;
            width: 100%;
            color: var(--text);
            font-size: 1rem;
            padding: 0;
        }

        .input-option input[type="text"]::placeholder,
        .input-option input[type="email"]::placeholder,
        .input-option input[type="tel"]::placeholder,
        .input-option textarea::placeholder {
            color: var(--text-muted);
        }

        /* Fix for select dropdowns */
        .input-option select {
            cursor: pointer;
        }

        .input-option select option {
            background: var(--dark-light);
            color: var(--text);
        }

        .option-label {
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .option-icon {
            width: 2rem;
            height: 2rem;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        /* === BUTTONS === */
        .btn {
            padding: 0.875rem 2rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: rgba(26, 30, 36, 0.8);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: rgba(58, 187, 250, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* === PREVIEW PANEL === */
        .preview-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .preview-dots {
            display: flex;
            gap: 0.25rem;
        }

        .preview-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
        }

        .preview-dot.red { background: #ff5f56; }
        .preview-dot.yellow { background: #ffbd2e; }
        .preview-dot.green { background: #27ca3f; }

        .site-preview {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
        }

        .preview-content {
            padding: 1.5rem;
            min-height: 400px;
            transition: all 0.3s ease;
        }

        .preview-placeholder {
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 1rem;
            border-radius: var(--radius);
        }

        .preview-info {
            background: rgba(43, 47, 53, 0.95);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        /* === ANIMATIONS === */
        @keyframes progressShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(58, 187, 250, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(58, 187, 250, 0); }
            100% { box-shadow: 0 0 0 0 rgba(58, 187, 250, 0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-20px); }
        }

        @keyframes shimmer {
            0% { background-position: 0 0, 0 10px, 10px -10px, -10px 0px; }
            100% { background-position: 40px 40px, 40px 50px, 50px 30px, 30px 40px; }
        }

        /* === RESPONSIVE === */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .preview-panel {
                border-left: none;
                border-top: 1px solid var(--border);
            }
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .step-title {
                font-size: 1.5rem;
            }
        }

        /* === UTILITY CLASSES === */
        .text-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .shadow-glow {
            box-shadow: 0 0 20px rgba(58, 187, 250, 0.3);
        }
        
        /* === ENHANCED ANIMATIONS === */
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease;
        }
        
        .slide-out {
            animation: slideOut 0.5s ease;
        }
        
        /* === RESPONSIVE ENHANCEMENTS === */
        @media (max-width: 768px) {
            .step-title {
                font-size: 1.5rem !important;
            }
            
            .input-group {
                grid-template-columns: 1fr !important;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group button {
                width: 100%;
            }
        }
        
        /* === ACCESSIBILITY === */
        .input-option:focus-within {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        button:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* === LOADING STATES === */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* === ADDITIONAL ENHANCEMENTS === */
        .form-group.text-center {
            text-align: center;
        }

        .form-group.text-center img {
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        .text-primary {
            color: var(--primary);
        }

        .text-primary-light {
            color: var(--primary-light);
        }

        .text-error {
            color: var(--error);
        }

        .text-text-muted {
            color: var(--text-muted);
        }

        /* === FOCUS STATES === */
        .input-option:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(58, 187, 250, 0.1);
        }

        /* === SELECTION INDICATORS === */
        .input-option.selected::before {
            content: '✓';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--primary);
            color: white;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* === LOADING STATES === */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        /* Add .feature-block styling to the <style> section for consistent look */
        .feature-block {
          margin-top: 1.5rem;
          margin-bottom: 1.5rem;
          padding: 1.5rem;
          border-radius: 1rem;
          background: #f8fafc;
          box-shadow: 0 4px 16px rgba(0,0,0,0.04);
          border: 1px solid #e5e7eb;
          text-align: center;
        }
        @media (max-width: 768px) {
          .feature-block {
            padding: 1rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
          }
        }

        /* Add/adjust .feature-block and new classes for polished feature styling */
        .feature-block {
          margin-top: 1.5rem;
          margin-bottom: 1.5rem;
          padding: 2rem 1.5rem;
          border-radius: 1rem;
          background: #f4f8fb;
          box-shadow: 0 4px 16px rgba(0,0,0,0.04);
          border: 1px solid #e5e7eb;
          text-align: center;
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
        }
        .feature-block h4, .feature-block label {
          font-size: 1.25rem;
          font-weight: 700;
          margin-bottom: 1rem;
          text-align: center;
        }
        .feature-newsletter-form {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.75rem;
          margin-top: 1rem;
        }
        @media (min-width: 640px) {
          .feature-newsletter-form {
            flex-direction: row;
            justify-content: center;
          }
        }
        .feature-newsletter-form input[type="email"] {
          border: 1px solid #cbd5e1;
          border-radius: 0.5rem;
          padding: 0.75rem 1rem;
          font-size: 1rem;
          width: 220px;
        }
        .feature-newsletter-form button {
          background: linear-gradient(90deg, #3abbfa 0%, #2a9ee0 100%);
          color: #fff;
          border: none;
          border-radius: 0.5rem;
          padding: 0.75rem 1.5rem;
          font-size: 1rem;
          font-weight: 600;
          box-shadow: 0 2px 8px rgba(58, 187, 250, 0.08);
          transition: background 0.2s, transform 0.2s;
        }
        .feature-newsletter-form button:hover {
          background: linear-gradient(90deg, #2a9ee0 0%, #3abbfa 100%);
          transform: translateY(-2px) scale(1.04);
        }
        .feature-chat-row {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 1.25rem;
          margin-top: 1rem;
        }
        .feature-chat-row .feature-chat-label {
          font-size: 1.1rem;
          font-weight: 600;
          color: #15803d;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        .feature-chat-row button {
          background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
          color: #fff;
          border: none;
          border-radius: 0.5rem;
          padding: 0.75rem 1.5rem;
          font-size: 1rem;
          font-weight: 600;
          box-shadow: 0 2px 8px rgba(34,197,94,0.08);
          transition: background 0.2s, transform 0.2s;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        .feature-chat-row button:hover {
          background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%);
          transform: translateY(-2px) scale(1.04);
        }
        .feature-social-icons {
          display: flex;
          justify-content: center;
          gap: 1.5rem;
          margin-top: 1rem;
        }
        .feature-social-icons a {
          color: #6366f1;
          background: #eef2ff;
          border-radius: 50%;
          width: 44px;
          height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.3rem;
          box-shadow: 0 2px 8px rgba(99,102,241,0.06);
          transition: background 0.2s, color 0.2s, transform 0.2s, opacity 0.2s;
        }
        .feature-social-icons a:hover {
          background: #6366f1;
          color: #fff;
          opacity: 0.92;
          transform: scale(1.08);
        }
        @media (max-width: 768px) {
          .feature-block {
            padding: 1rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
          }
        }

        /* Update .feature-block for integrated layout */
        .feature-block {
          background: #f4f8fb;
          border-radius: 1rem;
          box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
          padding: 0; /* Padding handled by outer container */
          margin: 0;  /* Margin handled by outer container */
          width: 100%;
          max-width: none;
          text-align: unset;
        }

        /* In renderServiceBusinessPreview (and similar), ensure:
        Each feature section is wrapped like:
        <div class="w-full max-w-6xl mx-auto px-6 py-8 bg-white rounded-xl shadow">
          <section class="feature-block"> ... </section>
        </div>
        Remove any extra centering or width from the feature-block HTML. */

        /* === FEATURE SELECTION ENHANCED STYLES === */
        .feature-select-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            padding: 0;
            margin: 0;
        }
        .feature-select-item {
            width: 100%;
            background: rgba(36, 41, 51, 0.96);
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 20px 28px;
            box-shadow: 0 2px 12px rgba(58, 187, 250, 0.06);
            transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .feature-select-item.selected,
        .feature-select-item:active {
            background: linear-gradient(90deg, #2563eb 0%, #1e293b 100%);
            color: #fff;
            box-shadow: 0 4px 24px rgba(37,99,235,0.13);
            transform: scale(1.01);
        }
        .feature-select-item:hover {
            background: #334155;
            box-shadow: 0 2px 16px rgba(58, 187, 250, 0.10);
        }
        .feature-select-item .option-icon {
            background: #3abbfa;
            color: #fff;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        @media (max-width: 600px) {
            .feature-select-item {
                padding: 14px 10px;
                font-size: 0.98rem;
            }
        }
    </style>
</head>
<body class="main-container">
    <!-- PIN Authentication Overlay -->
    <div id="authOverlay" class="auth-overlay fixed inset-0 z-50 flex items-center justify-center">
        <div class="auth-card p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <img src="Images/THLogo_trans.webp" alt="T&H WebWorks Logo" class="h-20 mx-auto mb-6">
                <h2 class="text-3xl font-bold text-gradient mb-3">Website Consultation Wizard</h2>
                <p class="text-text-muted text-lg">Enter PIN to access professional consultation</p>
            </div>
            
            <form id="pinForm" class="space-y-6">
                <div class="relative">
                    <input type="password" id="pinInput" maxlength="4" placeholder="Enter 4-digit PIN" 
                           class="auth-input w-full p-6 text-center text-3xl font-mono text-white">
                </div>
                
                <div id="pinError" class="text-error text-sm text-center hidden">
                    Incorrect PIN. Please try again.
                </div>
                
                <button type="submit" class="auth-btn w-full py-4 px-8 text-white text-lg">
                    Access Wizard
                </button>
            </form>
            
            <div class="mt-8 text-center">
                <p class="text-text-muted text-sm">For T&H WebWorks team use only</p>
                <a href="index.html" class="text-primary hover:text-primary-light text-sm mt-3 inline-block transition-colors">
                    ← Back to Toolkit
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until authenticated) -->
    <div id="mainContent" class="hidden">
        <main class="flex flex-col lg:flex-row min-h-screen">
            <!-- Form Panel -->
            <div class="flex-1 flex flex-col items-center justify-center py-12 px-6">
                <div class="form-panel w-full max-w-3xl p-8 md:p-10 relative">
                <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-semibold text-primary">Step <span id="progressStep">1</span> of <span id="progressTotal">8</span></span>
                            <span class="text-sm text-text-muted" id="progressLabel">Welcome</span>
                    </div>
                        <div class="w-full h-3 bg-dark-lighter rounded-full overflow-hidden">
                            <div id="progressBar" class="progress-bar h-3 transition-all duration-500" style="width: 12.5%"></div>
                    </div>
                </div>
                <!-- Dynamic Form -->
                <form id="wizardForm" class="space-y-8"></form>
            </div>
            </div>

            <!-- Live Preview Panel -->
            <div id="previewPanel" class="preview-panel w-full lg:w-1/2 p-8">
                <div class="sticky top-8">
                    <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                        <span class="text-primary mr-3">👁️</span>
                        Live Preview
                    </h3>
                    <div id="sitePreview" class="site-preview">
                        <div class="preview-header">
                            <div class="preview-dots">
                                <div class="preview-dot red"></div>
                                <div class="preview-dot yellow"></div>
                                <div class="preview-dot green"></div>
                            </div>
                            <span class="text-xs text-gray-600 ml-3">example.com</span>
                        </div>
                        <div class="preview-content">
                            <div class="preview-placeholder">
                                <div class="text-center">
                                    <div class="text-6xl mb-4">🎨</div>
                                    <div class="text-lg font-medium">Start building your site</div>
                                    <div class="text-sm text-gray-500 mt-2">Select your business type to begin</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preview Info -->
                    <div id="previewInfo" class="preview-info">
                        <h4 class="font-semibold text-primary mb-3 text-lg">Site Configuration</h4>
                        <div id="previewDetails" class="text-sm text-text-muted space-y-2">
                            <p>Select options to see your site configuration</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // PIN Authentication System
        const CORRECT_PIN = '1234';
        const authOverlay = document.getElementById('authOverlay');
        const mainContent = document.getElementById('mainContent');
        const pinForm = document.getElementById('pinForm');
        const pinInput = document.getElementById('pinInput');
        const pinError = document.getElementById('pinError');

        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('thwebworks_authenticated');
            if (isAuthenticated === 'true') {
                showMainContent();
            }
        }

        function showMainContent() {
            authOverlay.classList.add('hidden');
            mainContent.classList.remove('hidden');
        }

        pinForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const enteredPin = pinInput.value;
            
            if (enteredPin === CORRECT_PIN) {
                sessionStorage.setItem('thwebworks_authenticated', 'true');
                showMainContent();
                pinError.classList.add('hidden');
            } else {
                pinError.classList.remove('hidden');
                pinInput.value = '';
                pinInput.focus();
            }
        });

        pinInput.focus();
        checkAuth();

        // Prevent right-click and dev tools
        document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.key === 'u')) {
            e.preventDefault();
            }
        });

        // --- Wizard State Management ---
        let currentStep = 0;
        let formData = {};
        let previewEnabled = false; // Control when preview is visible
        
        // Initialize form data with default values
        function initializeFormData() {
            formData = {
                businessType: '',
                businessTypeOther: '',
                goals: [],
                goalsOther: '',
                pagesCore: [],
                pagesTrust: [],
                pagesEngage: [],
                pagesCommerce: [],
                features: [],
                designStyle: '',
                primaryColor: '#3abbfa',
                secondaryColor: '#f39c12',
                contactName: '',
                email: '',
                phone: '',
                budget: '',
                timeline: '',
                additionalNotes: '',
                exampleSites: '',
                sendEmailCopy: true
            };
        }
        
        // Reset wizard state
        function resetWizard() {
            formData = {};
            currentStep = 0;
            previewEnabled = false;
            initializeFormData();
            renderStep(currentStep);
            updatePreviewVisibility();
            // Reset progress bar and label
            document.getElementById('progressStep').textContent = 1;
            document.getElementById('progressTotal').textContent = wizardSteps.length;
            document.getElementById('progressLabel').textContent = wizardSteps[0].title || 'Welcome';
            document.getElementById('progressBar').style.width = `${(1/wizardSteps.length)*100}%`;
        }
        
        // Update preview visibility based on current step
        function updatePreviewVisibility() {
            const previewPanel = document.getElementById('previewPanel');
            if (previewPanel) {
                if (previewEnabled && currentStep >= 1) {
                    previewPanel.style.display = 'block';
                    previewPanel.classList.remove('hidden');
                } else {
                    previewPanel.style.display = 'none';
                    previewPanel.classList.add('hidden');
                }
            }
        }
        
        // --- Icon Mapping ---
        const icons = {
            'briefcase': '💼',
            'target': '🎯',
            'layout': '📄',
            'settings': '⚙️',
            'palette': '🎨',
            'dollar': '💰',
            'user': '👤',
            'check': '✅',
            'service-business': '🔧',
            'trades': '🔨',
            'consulting': '💡',
            'education': '📚',
            'real-estate-agency': '🏠',
            'tech-startup': '💻',
            'other': '📋'
        };

        function getIcon(key) {
            return icons[key] || '📋';
        }

        // --- Helper Functions for Form Interactions ---
        
        // Save form data to localStorage
        function saveFormData() {
            localStorage.setItem('consultationWizardData', JSON.stringify(formData));
        }
        
        function selectRadioOption(name, value) {
            formData[name] = value;
            // Update visual state
            const options = document.querySelectorAll(`input[name="${name}"]`);
            if (options) {
                options.forEach(option => {
                    const optionDiv = option.closest('.input-option');
                    if (!optionDiv) return;
                    if (option.value === value) {
                        option.checked = true;
                        optionDiv.classList.add('selected');
                    } else {
                        option.checked = false;
                        optionDiv.classList.remove('selected');
                    }
                });
            }
            // Trigger preview update
            handleImmediateVisualChanges({ name, value });
            updatePreview();
        }

        function toggleCheckboxOption(name, value) {
            if (!formData[name]) formData[name] = [];
            const optionInput = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (!optionInput) return;
            const optionDiv = optionInput.closest('.input-option');
            if (!optionDiv) return;
            const checkbox = optionDiv.querySelector('input[type="checkbox"]');
            if (!checkbox) return;
            if (checkbox.checked) {
                // Uncheck
                checkbox.checked = false;
                optionDiv.classList.remove('selected');
                formData[name] = formData[name].filter(v => v !== value);
            } else {
                // Check
                checkbox.checked = true;
                optionDiv.classList.add('selected');
                formData[name].push(value);
            }
            // IMMEDIATE visual feedback for specific options
            handleImmediateVisualChanges({ name, value });
            updatePreview();
        }

        // --- Website Vision Builder with Enhanced UX ---
        const wizardSteps = [
            // 0. Welcome & Introduction
            {
                id: 'welcome',
                title: 'Let\'s Get Started',
                subtitle: 'Professional Website Consultation',
                icon: 'home',
                description: 'We\'ll guide you through a few quick questions to help build the perfect website for your business.',
                fields: [
                    { 
                        type: 'branding', 
                        logo: 'Images/THLogo_trans.webp', 
                        mission: 'Premium web development for businesses that want to stand out.', 
                        subheader: 'Your business, our expertise, exceptional results.' 
                    },
                    { 
                        type: 'intro', 
                        description: 'We\'ll walk through your requirements step by step, and you\'ll see your website take shape in real-time as we discuss your needs.' 
                    },
                    { 
                        type: 'button', 
                        label: 'Start Consultation', 
                        action: 'next', 
                        icon: 'arrow-right',
                        classes: 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-lg font-semibold text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105' 
                    }
                ]
            },
            
            // 1. Business Type Selection
            {
                id: 'business-type',
                title: 'What Type of Business Are You?',
                subtitle: 'Select your business category',
                icon: 'building',
                description: 'This helps us create a website layout that\'s perfect for your industry.',
                fields: [
                    { 
                        type: 'radio', 
                        name: 'businessType', 
                        label: 'Business Type', 
                        description: 'Choose the category that best describes your business',
                        options: [
                            { value: 'service-business', label: 'Service Business', icon: 'wrench', description: 'Professional services (consulting, legal, etc.)' },
                            { value: 'trades', label: 'Trades', icon: 'hammer', description: 'Construction, plumbing, electrical, etc.' },
                            { value: 'consulting', label: 'Consulting', icon: 'lightbulb', description: 'Business consulting & advisory' },
                            { value: 'education', label: 'Education', icon: 'graduation-cap', description: 'Schools, training, courses' },
                            { value: 'real-estate-agency', label: 'Real Estate Agency', icon: 'home', description: 'Real estate agencies & agents' },
                            { value: 'other', label: 'Other', icon: 'plus', description: 'Other business type' }
                        ], 
                        required: true,
                        showOtherInput: true
                    }
                ]
            },
            
            // 2. Website Goals
            {
                id: 'goals',
                title: 'What Are Your Website Goals?',
                subtitle: 'Define your primary objectives',
                icon: 'target',
                description: 'Understanding your goals helps us prioritize features and design elements that will drive results.',
                fields: [
                    { 
                        type: 'checkbox-group', 
                        name: 'goals', 
                        label: 'Primary Goals', 
                        description: 'Select all that apply to your business',
                        options: [
                            { value: 'Lead Generation', icon: 'users', description: 'Generate new leads and inquiries' },
                            { value: 'Online Booking', icon: 'calendar', description: 'Allow customers to book appointments' },
                            { value: 'Selling Products', icon: 'shopping-cart', description: 'Sell products or services online' },
                            { value: 'Portfolio Display', icon: 'image', description: 'Showcase your work or products' },
                            { value: 'Event Promotion', icon: 'calendar-days', description: 'Promote events and activities' },
                            { value: 'Content Marketing', icon: 'file-text', description: 'Share valuable content and insights' },
                            { value: 'SEO Visibility', icon: 'search', description: 'Improve search engine rankings' },
                            { value: 'Brand Trust', icon: 'shield', description: 'Build credibility and trust' },
                            { value: 'Client Login', icon: 'user-check', description: 'Provide client portal access' },
                            { value: 'Other', icon: 'plus', description: 'Other specific goals' }
                        ], 
                        vertical: true, 
                        required: true,
                        showOtherInput: true,
                        maxSelections: 5
                    }
                ]
            },
            
            // 3. Website Pages
            {
                id: 'pages',
                title: 'What Pages Do You Need?',
                subtitle: 'Structure your website content',
                icon: 'layout',
                description: 'Choose the pages that will make up your website. We\'ll organize them for optimal user experience.',
                fields: [
                    { 
                        type: 'checkbox-group', 
                        name: 'pagesCore', 
                        label: 'Core Pages', 
                        description: 'Essential pages every business needs',
                        options: [
                            { value: 'Home', icon: 'home', description: 'Main landing page' },
                            { value: 'About', icon: 'info', description: 'About your business' },
                            { value: 'Services', icon: 'settings', description: 'Your services or products' },
                            { value: 'Contact', icon: 'phone', description: 'Contact information' }
                        ], 
                        vertical: true 
                    },
                    { 
                        type: 'checkbox-group', 
                        name: 'pagesTrust', 
                        label: 'Trust Building', 
                        description: 'Pages that build credibility',
                        options: [
                            { value: 'Testimonials', icon: 'star', description: 'Customer reviews' },
                            { value: 'FAQ', icon: 'help-circle', description: 'Frequently asked questions' },
                            { value: 'Case Studies', icon: 'folder-open', description: 'Success stories' },
                            { value: 'Team', icon: 'users', description: 'Meet your team' }
                        ], 
                        vertical: true 
                    },
                    { 
                        type: 'checkbox-group', 
                        name: 'pagesEngage', 
                        label: 'Engagement', 
                        description: 'Pages to keep visitors engaged',
                        options: [
                            { value: 'Resources', icon: 'book-open', description: 'Helpful resources' },
                            { value: 'Events', icon: 'calendar', description: 'Upcoming events' },
                            { value: 'Newsletter', icon: 'mail', description: 'Email signup' }
                        ], 
                        vertical: true 
                    }
                ]
            },
            
            // 4. Features & Functionality
            {
                id: 'features',
                title: 'What Features Do You Need?',
                subtitle: 'Choose your website functionality',
                icon: 'settings',
                description: 'Select the features that will help you achieve your goals and provide value to your visitors.',
                fields: [
                    { 
                        type: 'checkbox-group', 
                        name: 'features', 
                        label: 'Website Features', 
                        description: 'Select the features you need',
                        options: [
                            { value: 'Contact Forms', icon: 'mail', description: 'Contact and inquiry forms' },
                            { value: 'Online Scheduler', icon: 'calendar-plus', description: 'Appointment booking system' },
                            { value: 'Payment Processing', icon: 'credit-card', description: 'Online payments' },
                            { value: 'Newsletter Signup', icon: 'mail', description: 'Email marketing integration' },
                            { value: 'Google Maps', icon: 'map-pin', description: 'Location and directions' },
                            { value: 'Client Dashboard', icon: 'user', description: 'Client portal access' },
                            { value: 'Live Chat', icon: 'message-circle', description: 'Real-time customer support' },
                            { value: 'Social Media Integration', icon: 'share-2', description: 'Social media feeds' },
                            { value: 'Analytics', icon: 'bar-chart', description: 'Website analytics' }
                            // Mobile App removed
                        ], 
                        vertical: true,
                        showOtherInput: true
                    }
                ]
            },
            
            // 5. Design Preferences
            {
                id: 'design',
                title: 'What Design Style Appeals to You?',
                subtitle: 'Choose your visual direction',
                icon: 'palette',
                description: 'Your design style will influence the overall look and feel of your website.',
                fields: [
                    { 
                        type: 'radio', 
                        name: 'designStyle', 
                        label: 'Design Style', 
                        description: 'Select the style that best represents your brand',
                        options: [
                            { value: 'Modern & Clean', icon: 'zap', description: 'Minimal, contemporary design' },
                            { value: 'Bold & Creative', icon: 'sparkles', description: 'Eye-catching, artistic design' },
                            { value: 'Professional & Corporate', icon: 'briefcase', description: 'Trustworthy, business-focused' },
                            { value: 'Warm & Friendly', icon: 'heart', description: 'Approachable, welcoming design' },
                            { value: 'Minimalist', icon: 'minus', description: 'Simple, focused design' },
                            { value: 'Luxury & Premium', icon: 'crown', description: 'Sophisticated, high-end design' }
                        ], 
                        required: true 
                    }
                ]
            },
            
            // 6. Color & Branding
            {
                id: 'colors',
                title: 'Color & Branding Preferences',
                subtitle: 'Define your visual identity',
                icon: 'droplets',
                description: 'Colors play a crucial role in brand recognition and user experience.',
                fields: [
                    { 
                        type: 'color', 
                        name: 'primaryColor', 
                        label: 'Primary Brand Color', 
                        description: 'Your main brand color',
                        placeholder: '#3abbfa or blue', 
                        required: true,
                        icon: 'palette'
                    },
                    { 
                        type: 'color', 
                        name: 'secondaryColor', 
                        label: 'Secondary Color', 
                        description: 'Accent color for highlights',
                        placeholder: '#f39c12 or gold', 
                        required: true,
                        icon: 'palette'
                    },
                    { 
                        type: 'text', 
                        name: 'exampleSites', 
                        label: 'Example Websites You Like', 
                        description: 'Share URLs of websites whose design you admire',
                        placeholder: 'Paste URLs separated by commas (e.g., example.com, another-site.com)',
                        icon: 'link'
                    }
                ]
            },
            
            // 7. Contact & Project Details
            {
                id: 'contact',
                title: 'Contact Details & Project Scope',
                subtitle: 'Let\'s get in touch',
                icon: 'mail',
                description: 'Provide your contact information and project preferences so we can create a custom proposal.',
                fields: [
                    { 
                        type: 'text', 
                        name: 'contactName', 
                        label: 'Contact Name', 
                        placeholder: 'Your full name',
                        required: true,
                        icon: 'user'
                    },
                    { 
                        type: 'email', 
                        name: 'email', 
                        label: 'Business Email', 
                        placeholder: 'your@email.com',
                        required: true,
                        icon: 'mail'
                    },
                    { 
                        type: 'tel', 
                        name: 'phone', 
                        label: 'Phone Number', 
                        placeholder: '(555) 123-4567',
                        required: true,
                        icon: 'phone'
                    },
                    { 
                        type: 'radio', 
                        name: 'budget', 
                        label: 'Budget Range', 
                        description: 'Help us provide the right solution for your budget',
                        options: [
                            { value: '<$500', icon: 'dollar-sign', description: 'Basic website package' },
                            { value: '$500–$1000', icon: 'dollar-sign', description: 'Standard website package' },
                            { value: '$1000–$2000', icon: 'dollar-sign', description: 'Premium website package' },
                            { value: '$2000+', icon: 'dollar-sign', description: 'Custom enterprise solution' }
                        ], 
                        required: true 
                    },
                    { 
                        type: 'dropdown', 
                        name: 'timeline', 
                        label: 'Project Timeline', 
                        description: 'When do you need your website completed?',
                        options: ['ASAP', '1 week', '2–4 weeks', '1–2 months', '2+ months'],
                        icon: 'clock'
                    },
                    { 
                        type: 'textarea', 
                        name: 'additionalNotes', 
                        label: 'Additional Notes', 
                        description: 'Any specific requirements, preferences, or questions?',
                        placeholder: 'Tell us anything else we should know about your project...',
                        rows: 4,
                        icon: 'file-text'
                    }
                ]
            },
            
            // 8. Summary & Submission
            {
                id: 'summary',
                title: 'Review Your Website Vision',
                subtitle: 'Almost there!',
                icon: 'check-circle',
                description: 'Review your selections and submit your project request. We\'ll get back to you with a custom proposal within 24 hours.',
                fields: [
                    { type: 'summary' },
                    { 
                        type: 'toggle', 
                        name: 'sendEmailCopy', 
                        label: 'Send me a copy of this summary', 
                        description: 'Receive a copy of your project summary via email',
                        default: true
                    },
                    { 
                        type: 'button-group', 
                        buttons: [
                            { 
                                label: 'Download Summary', 
                                action: 'download', 
                                icon: 'download',
                                classes: 'bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300' 
                            },
                            { 
                                label: 'Submit Project Request', 
                                action: 'submit', 
                                icon: 'send',
                                classes: 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105' 
                            }
                        ]
                    }
                ]
            }
        ];





        // --- ENHANCED PREVIEW TEMPLATES WITH UNIQUE LAYOUTS ---
        const previewTemplates = {
            'service-business': {
                name: 'ProFix Solutions',
                tagline: 'Professional Services You Can Trust',
                features: ['Service showcase', 'Booking system', 'Testimonials', 'Contact forms', 'Service areas', 'Emergency calls'],
                color: '#2ecc71',
                heroImage: '🔧',
                icons: ['⚙️', '📞', '💬', '📍'],
                specialties: ['24/7 Support', 'Guaranteed Work', 'Free Estimates'],
                layout: 'service',
                sections: ['hero', 'services-grid', 'why-choose-us', 'testimonials', 'service-areas', 'emergency-contact']
            },
            'trades': {
                name: 'MasterCraft Trades',
                tagline: 'Quality Workmanship & Reliable Service',
                features: ['Service areas', 'Project gallery', 'Free quotes', 'Emergency contact', 'Licensed & insured', 'Warranty'],
                color: '#f39c12',
                heroImage: '🔨',
                icons: ['🏠', '🛠️', '📋', '🚨'],
                specialties: ['Residential', 'Commercial', 'Emergency Repairs'],
                layout: 'trades',
                sections: ['hero', 'services-showcase', 'project-gallery', 'certifications', 'service-areas', 'emergency-contact']
            },
            'consulting': {
                name: 'Strategic Growth Partners',
                tagline: 'Expert Solutions for Business Success',
                features: ['Case studies', 'Expert team', 'Services overview', 'Client testimonials', 'Strategy sessions', 'ROI tracking'],
                color: '#9b59b6',
                heroImage: '📊',
                icons: ['📈', '👥', '💼', '🎯'],
                specialties: ['Business Strategy', 'Digital Transformation', 'Growth Consulting'],
                layout: 'consulting',
                sections: ['hero', 'expertise-areas', 'case-studies', 'team', 'process', 'results']
            },
            'education': {
                name: 'Innovation Academy',
                tagline: 'Empowering Minds, Building Futures',
                features: ['Course catalog', 'Student portal', 'Faculty directory', 'Events calendar', 'Alumni network', 'Online learning'],
                color: '#34495e',
                heroImage: '🎓',
                icons: ['📚', '👨‍🏫', '🎯', '🌐'],
                specialties: ['Higher Education', 'Professional Development', 'Online Courses'],
                layout: 'education',
                sections: ['hero', 'programs-overview', 'faculty', 'student-life', 'admissions', 'alumni-network']
            },
            'real-estate-agency': {
                name: 'Premier Real Estate Group',
                tagline: 'Find Your Dream Home',
                features: ['Property listings', 'Virtual tours', 'Mortgage calculator', 'Agent profiles', 'Market insights', 'Contact forms'],
                color: '#8e44ad',
                heroImage: '🏠',
                icons: ['🔑', '📊', '👥', '📞'],
                specialties: ['Residential', 'Commercial', 'Investment Properties'],
                layout: 'real-estate',
                sections: ['hero', 'featured-properties', 'search-tools', 'agents', 'market-insights', 'mortgage-calculator']
            },
            'tech-startup': {
                name: 'TechFlow Solutions',
                tagline: 'Innovation at Your Fingertips',
                features: ['Product demos', 'API documentation', 'Support portal', 'Case studies', 'Developer resources', 'Pricing plans'],
                color: '#2c3e50',
                heroImage: '💻',
                icons: ['🚀', '🔧', '📱', '☁️'],
                specialties: ['SaaS Solutions', 'Mobile Apps', 'Cloud Services'],
                layout: 'technology',
                sections: ['hero', 'products-showcase', 'features', 'pricing', 'case-studies', 'developer-hub']
            },
            'other': {
                name: 'Your Business',
                tagline: 'Professional Solutions for Your Needs',
                features: ['Custom solutions', 'Professional service', 'Quality work', 'Customer support', 'Flexible options', 'Reliable results'],
                color: '#3abbfa',
                heroImage: '💼',
                icons: ['🎯', '⚡', '💡', '🤝'],
                specialties: ['Custom Solutions', 'Professional Service', 'Quality Work'],
                layout: 'default',
                sections: ['hero', 'services', 'about', 'contact']
            }
        };

    // --- Enhanced Render Step Function ---
    function renderStep(idx) {
        const step = wizardSteps[idx];
        const form = document.getElementById('wizardForm');
        form.innerHTML = '';
            
        // Enhanced Step Header
        if (step.title) {
            form.innerHTML += `
                <div class="form-step active">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full mb-4">
                            <i class="fas fa-${step.icon} text-white text-2xl"></i>
                        </div>
                        <h2 class="step-title text-3xl mb-2">${step.title}</h2>
                        ${step.subtitle ? `<h3 class="text-xl text-text-muted mb-4">${step.subtitle}</h3>` : ''}
                        ${step.description ? `<p class="step-description max-w-2xl mx-auto">${step.description}</p>` : ''}
                    </div>
                </div>
            `;
        }
            
        // Enhanced Fields Rendering
        step.fields.forEach(field => {
            if (field.type === 'branding') {
                form.innerHTML += `
                    <div class="form-group text-center">
                        <img src="${field.logo}" alt="T&H WebWorks Logo" class="h-24 mx-auto mb-6">
                        <div class="text-text-muted text-xl mb-3 font-medium">${field.mission}</div>
                        <div class="text-text-muted text-base mb-6">${field.subheader}</div>
                        <div class="flex gap-4 justify-center">
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--primary)"></span>
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--secondary)"></span>
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--accent)"></span>
                        </div>
                    </div>
                `;
            } else if (field.type === 'intro') {
                form.innerHTML += `
                    <div class="form-group text-center">
                        <div class="bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-xl p-8">
                            <p class="step-description text-lg leading-relaxed">${field.description}</p>
                        </div>
                    </div>
                `;
            } else if (field.type === 'text' || field.type === 'email' || field.type === 'tel') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}${field.required ? ' <span class="text-error">*</span>' : ''}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-3">${field.description}</p>` : ''}
                        <input type="${field.type}" name="${field.name}" placeholder="${field.placeholder || ''}" 
                               class="input-option w-full p-4 text-white transition-all duration-300 focus:border-primary focus:ring-2 focus:ring-primary/20" 
                               ${field.required ? 'required' : ''} 
                               value="${formData[field.name] || ''}">
                    </div>
                `;
            } else if (field.type === 'color') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}${field.required ? ' <span class="text-error">*</span>' : ''}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-3">${field.description}</p>` : ''}
                        <div class="flex items-center gap-4">
                            <input type="color" name="${field.name}" 
                                   class="w-16 h-16 p-0 border-none bg-transparent rounded-lg cursor-pointer hover:scale-110 transition-transform duration-200" 
                                   value="${formData[field.name] || '#3abbfa'}">
                            <input type="text" name="${field.name}" placeholder="${field.placeholder || ''}" 
                                   class="input-option flex-1 p-4 text-white" 
                                   value="${formData[field.name] || ''}">
                        </div>
                    </div>
                `;
            } else if (field.type === 'radio') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}${field.required ? ' <span class="text-error">*</span>' : ''}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-4">${field.description}</p>` : ''}
                        <div class="input-group grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${field.options.map(opt => `
                                <div class="input-option ${formData[field.name] === opt.value ? 'selected' : ''} hover:border-primary/50 transition-all duration-300" 
                                     onclick="selectRadioOption('${field.name}', '${opt.value}')">
                                    <input type="radio" name="${field.name}" value="${opt.value}" 
                                           ${formData[field.name] === opt.value ? 'checked' : ''}>
                                    <label class="option-label cursor-pointer">
                                        <div class="option-icon bg-gradient-to-r from-blue-500 to-blue-600">
                                            <i class="fas fa-${opt.icon} text-white"></i>
                                        </div>
                                        <div class="flex-1">
                                            <span class="font-semibold">${opt.label || opt.value}</span>
                                            <p class="text-sm text-text-muted mt-1">${opt.description}</p>
                                        </div>
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                        ${field.showOtherInput ? `
                            <div class="mt-4" id="other-${field.name}" style="display: ${formData[field.name] === 'Other' ? 'block' : 'none'}">
                                <input type="text" name="${field.name}Other" placeholder="Please specify..." 
                                       class="input-option w-full p-4 text-white" 
                                       value="${formData[field.name + 'Other'] || ''}">
                            </div>
                        ` : ''}
                    </div>
                `;
            } else if (field.type === 'checkbox-group') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}${field.required ? ' <span class="text-error">*</span>' : ''}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-4">${field.description}</p>` : ''}
                        <div class="input-group grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${field.options.map(opt => `
                                <label class="input-option ${formData[field.name] && formData[field.name].includes(opt.value) ? 'selected' : ''} hover:border-primary/50 transition-all duration-300">
                                    <input type="checkbox" name="${field.name}" value="${opt.value}" 
                                           ${formData[field.name] && formData[field.name].includes(opt.value) ? 'checked' : ''}>
                                    <span class="option-label cursor-pointer">
                                        <span class="option-icon bg-gradient-to-r from-blue-500 to-blue-600">
                                            <i class="fas fa-${opt.icon} text-white"></i>
                                        </span>
                                        <span class="flex-1">
                                            <span class="font-semibold">${opt.label || opt.value}</span>
                                            <p class="text-sm text-text-muted mt-1">${opt.description}</p>
                                        </span>
                                    </span>
                                </label>
                            `).join('')}
                        </div>
                        ${field.showOtherInput ? `
                            <div class="mt-4" id="other-${field.name}" style="display: ${formData[field.name] && formData[field.name].includes('Other') ? 'block' : 'none'}">
                                <input type="text" name="${field.name}Other" placeholder="Please specify..." 
                                       class="input-option w-full p-4 text-white" 
                                       value="${formData[field.name + 'Other'] || ''}">
                            </div>
                        ` : ''}
                        ${field.maxSelections ? `
                            <p class="text-sm text-text-muted mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Select up to ${field.maxSelections} options
                            </p>
                        ` : ''}
                    </div>
                `;
            } else if (field.type === 'dropdown') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-3">${field.description}</p>` : ''}
                        <select name="${field.name}" class="input-option w-full p-4 text-white">
                            <option value="">Select...</option>
                            ${field.options.map(opt => `<option value="${opt}" ${formData[field.name] === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    </div>
                `;
            } else if (field.type === 'textarea') {
                form.innerHTML += `
                    <div class="form-group">
                        <label class="form-label flex items-center gap-2">
                            ${field.icon ? `<i class="fas fa-${field.icon} text-primary"></i>` : ''}
                            ${field.label}
                        </label>
                        ${field.description ? `<p class="form-description text-sm text-text-muted mb-3">${field.description}</p>` : ''}
                        <textarea name="${field.name}" rows="${field.rows || 4}" 
                                  class="input-option w-full p-4 text-white resize-none transition-all duration-300 focus:border-primary focus:ring-2 focus:ring-primary/20">${formData[field.name] || ''}</textarea>
                    </div>
                `;
            } else if (field.type === 'toggle') {
                form.innerHTML += `
                    <div class="form-group">
                        <div class="flex items-center justify-between p-4 bg-dark-light rounded-lg">
                            <div>
                                <label class="form-label">${field.label}</label>
                                ${field.description ? `<p class="form-description text-sm text-text-muted mt-1">${field.description}</p>` : ''}
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="${field.name}" class="sr-only peer" 
                                       ${formData[field.name] !== false ? 'checked' : ''}>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                `;
            } else if (field.type === 'button') {
                form.innerHTML += `
                    <div class="form-group text-center">
                        <button type="button" class="${field.classes}" data-action="${field.action}">
                            ${field.icon ? `<i class="fas fa-${field.icon} mr-2"></i>` : ''}
                            ${field.label}
                        </button>
                    </div>
                `;
            } else if (field.type === 'button-group') {
                form.innerHTML += `
                    <div class="form-group">
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            ${field.buttons.map(btn => `
                                <button type="button" class="${btn.classes}" data-action="${btn.action}">
                                    ${btn.icon ? `<i class="fas fa-${btn.icon} mr-2"></i>` : ''}
                                    ${btn.label}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (field.type === 'summary') {
                form.innerHTML += `
                    <div class="form-group">
                        <div class="bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-xl p-6">
                            ${renderSummary()}
                        </div>
                    </div>
                `;
            }
        });
            
        // Enhanced Navigation
        if (idx === 0) {
            // Remove the small progress label at the top
            document.getElementById('progressLabel').style.display = 'none';
            // Move logo to top under progress bar
            form.innerHTML = `
                <div class="form-step active">
                    <div class="text-center mb-8">
                        <img src="Images/THLogo_trans.webp" alt="T&H WebWorks Logo" class="h-24 mx-auto mb-6">
                        <h2 class="step-title text-3xl mb-2">Let's Get Started</h2>
                        <h3 class="text-xl text-text-muted mb-4">Professional Website Consultation</h3>
                        <p class="step-description max-w-2xl mx-auto">We'll guide you through a few quick questions to help build the perfect website for your business.</p>
                        <div class="text-text-muted text-xl mb-3 font-medium">Premium web development for businesses that want to stand out.</div>
                        <div class="text-text-muted text-base mb-6">Your business, our expertise, exceptional results.</div>
                        <div class="flex gap-4 justify-center mb-6">
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--primary)"></span>
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--secondary)"></span>
                            <span class="w-8 h-8 rounded-full shadow-glow" style="background:var(--accent)"></span>
                        </div>
                    </div>
                </div>
            `;
            // Add only the main action buttons at the bottom
            form.innerHTML += `
                <div class="btn-group flex flex-col sm:flex-row gap-4 mt-8">
                    <button type="button" class="btn btn-secondary flex items-center justify-center gap-2" data-action="reset">
                        <i class="fas fa-refresh"></i>
                        Start Over
                    </button>
                    <button type="button" class="btn btn-primary flex items-center justify-center gap-2" data-action="next">
                        Start Consultation
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;
            // Hide preview if visible
            updatePreviewVisibility();
            return;
        } else if (idx > 0 && idx < wizardSteps.length - 1) {
            // For Step 2 and all middle steps, show Back, Continue, and Start Over
            form.innerHTML += `
                <div class="btn-group flex flex-col sm:flex-row gap-4 mt-8">
                    <button type="button" class="btn btn-secondary flex items-center justify-center gap-2" data-action="back">
                        <i class="fas fa-arrow-left"></i>
                        Back
                    </button>
                    <button type="button" class="btn btn-primary flex items-center justify-center gap-2" data-action="next">
                        Continue
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="button" class="btn btn-secondary flex items-center justify-center gap-2" data-action="reset">
                        <i class="fas fa-refresh"></i>
                        Start Over
                    </button>
                </div>
            `;
        } else {
            // Restore progress label for other steps
            document.getElementById('progressLabel').style.display = '';
        }
            
        // Progress bar
        document.getElementById('progressStep').textContent = idx + 1;
        document.getElementById('progressTotal').textContent = wizardSteps.length;
        document.getElementById('progressLabel').textContent = step.title || 'Welcome';
        document.getElementById('progressBar').style.width = `${((idx+1)/wizardSteps.length)*100}%`;
        
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    }

        // --- Enhanced Update Preview with Animations ---
        function updatePreview() {
            const preview = document.getElementById('sitePreview');
            if (!preview) return;
            const details = document.getElementById('previewDetails');
            const progressBar = document.getElementById('progressBar');
            if (!details || !progressBar) return;
            
            // Don't update preview if it's not enabled yet
            if (!previewEnabled) {
                return;
            }
            
            // Add loading animation
            preview.style.opacity = '0.7';
            preview.style.transform = 'scale(0.98)';
            
            setTimeout(() => {
                if (!formData.businessType) {
                    preview.querySelector('.preview-content').innerHTML = `
                        <div class="preview-placeholder float-animation">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 16px;">🎨</div>
                                <div>Select your business type to see a live preview</div>
                                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">Choose from the options above</div>
                            </div>
                        </div>
                    `;
                    details.innerHTML = '<p>Select your business type to see your site configuration</p>';
                } else {
                    const template = previewTemplates[formData.businessType] || previewTemplates['service-business'];
                    const primaryColor = formData.primaryColor || '#3abbfa';
                    const secondaryColor = formData.secondaryColor || '#f39c12';
                    const designStyle = formData.designStyle || 'Modern & Clean';
                    
                    // Generate preview HTML based on business type
                    const previewHTML = generateBusinessTypePreview(template, primaryColor, designStyle);
                    preview.querySelector('.preview-content').innerHTML = previewHTML;
                    
                    // Add interactive elements to preview
                    addPreviewInteractions();
                    
                    // Update details with animations
                    let detailsHTML = `<p><strong>Business Type:</strong> ${formData.businessType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>`;
                    if (formData.goals && formData.goals.length > 0) {
                        detailsHTML += `<p><strong>Goals:</strong> ${formData.goals.join(', ')}</p>`;
                    }
                    if (formData.pagesCore && formData.pagesCore.length > 0) {
                        detailsHTML += `<p><strong>Core Pages:</strong> ${formData.pagesCore.join(', ')}</p>`;
                    }
                    if (formData.pagesTrust && formData.pagesTrust.length > 0) {
                        detailsHTML += `<p><strong>Trust Pages:</strong> ${formData.pagesTrust.join(', ')}</p>`;
                    }
                    
                    details.innerHTML = detailsHTML;
                }
                
                // Restore preview
                preview.style.opacity = '1';
                preview.style.transform = 'scale(1)';
                
                // Add animated progress bar
                progressBar.classList.add('progress-animated');
                setTimeout(() => progressBar.classList.remove('progress-animated'), 2000);
                
            }, 300);
        }
        
        // --- Add Interactive Elements to Preview ---
        function addPreviewInteractions() {
            const preview = document.getElementById('sitePreview');
            if (!preview) return;
            // Add hover effects to buttons
            const buttons = preview.querySelectorAll('button');
            if (buttons) {
                buttons.forEach(button => {
                    button.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px) scale(1.05)';
                        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
                    });
                    button.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0) scale(1)';
                        this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
                    });
                });
            }
            // Add click effects to navigation
            const navItems = preview.querySelectorAll('nav span');
            if (navItems) {
                navItems.forEach(item => {
                    item.addEventListener('click', function() {
                        navItems.forEach(nav => nav.style.color = '');
                        navItems.forEach(nav => nav.style.fontWeight = '400');
                        this.style.color = '#3abbfa';
                        this.style.fontWeight = '600';
                        this.classList.add('pulse-animation');
                        setTimeout(() => this.classList.remove('pulse-animation'), 1000);
                    });
                });
            }
            // Add floating animation to hero emoji
            const heroEmoji = preview.querySelector('div[style*="font-size: 64px"]');
            if (heroEmoji) {
                heroEmoji.classList.add('float-animation');
            }
        }
        
        // --- Calculate Estimated Cost ---
        function calculateEstimatedCost() {
            let baseCost = 0;
            
            // Base cost by business type
            const businessCosts = {
                'Restaurant': 1500,
                'Retail Store': 2000,
                'Service Business': 1200,
                'Consulting': 1800,
                'Health & Wellness': 1600,
                'Trades': 1400,
                'Nonprofit': 1000,
                'Education': 2200,
                'Real Estate': 2500,
                'Technology': 3000
            };
            
            baseCost = businessCosts[formData.businessType] || 1500;
            
            // Add cost for features
            if (formData.features) {
                const featureCosts = {
                    'Online Scheduler': 300,
                    'Payment Processing': 400,
                    'Client Dashboard': 500,
                    'Live Chat': 200,
                    'Social Media Integration': 150,
                    'Analytics': 100,
                    'Mobile App': 800
                };
                
                formData.features.forEach(feature => {
                    baseCost += featureCosts[feature] || 0;
                });
            }
            
            // Add cost for pages
            if (formData.pagesCore) {
                baseCost += formData.pagesCore.length * 100;
            }
            if (formData.pagesTrust) {
                baseCost += formData.pagesTrust.length * 150;
            }
            if (formData.pagesEngage) {
                baseCost += formData.pagesEngage.length * 200;
            }
            if (formData.pagesCommerce) {
                baseCost += formData.pagesCommerce.length * 300;
            }
            
            // Format cost
            if (baseCost < 1000) {
                return `$${baseCost}`;
            } else if (baseCost < 5000) {
                return `$${(baseCost/1000).toFixed(1)}k`;
            } else {
                return `$${(baseCost/1000).toFixed(0)}k`;
            }
        }

        // --- BUSINESS TYPE PREVIEW GENERATOR ---
        function generateBusinessTypePreview(template, primaryColor, designStyle) {
            const businessName = template.name;
            const secondaryColor = formData.secondaryColor || '#f39c12';
            const colors = {
                primary: primaryColor,
                secondary: secondaryColor,
                accent: secondaryColor
            };
            
            // Generate unique layout based on business type
            switch (template.layout) {
                case 'service':
                    return generateServiceBusinessLayout(template, colors);
                case 'trades':
                    return generateTradesLayout(template, colors);
                case 'consulting':
                    return generateConsultingLayout(template, colors);
                case 'education':
                    return generateEducationLayout(template, colors);
                case 'real-estate':
                    return generateRealEstateLayout(template, colors);
                case 'technology':
                    return generateTechnologyLayout(template, colors);
                default:
                    return generateDefaultLayout(template, colors);
            }
        }
        
        // --- LAYOUT GENERATORS FOR EACH BUSINESS TYPE ---
        function generateServiceBusinessLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header style="background: ${colors.primary}; color: white; padding: 1rem;">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Services</span>
                                <span class="cursor-pointer hover:text-blue-200">About</span>
                                <span class="cursor-pointer hover:text-blue-200">Contact</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section style="background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.primary} 100%); color: white; padding: 64px 20px; text-align: center;">
                        <div class="max-w-4xl mx-auto px-4">
                            <div style="font-size: 64px; margin-bottom: 24px;">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Professional Services</h2>
                            <p class="text-xl mb-8 opacity-90">Quality solutions you can trust</p>
                            <button style="background: white; color: ${colors.primary}; padding: 12px 32px; border-radius: 9999px; font-weight: 600; border: none; cursor: pointer; transition: background 0.3s ease;">
                                Get Started
                            </button>
                        </div>
                    </section>
                    
                    <!-- Services Grid -->
                    <section class="py-16 bg-gray-50">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Services</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">🔧</div>
                                    <h4 class="font-semibold mb-2">Service 1</h4>
                                    <p class="text-gray-600 text-sm">Professional service description</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">⚡</div>
                                    <h4 class="font-semibold mb-2">Service 2</h4>
                                    <p class="text-gray-600 text-sm">Fast and reliable solutions</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">📋</div>
                                    <h4 class="font-semibold mb-2">Service 3</h4>
                                    <p class="text-gray-600 text-sm">Comprehensive service package</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateTradesLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header style="background: ${colors.primary}; color: white; padding: 1rem;">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Services</span>
                                <span class="cursor-pointer hover:text-blue-200">Gallery</span>
                                <span class="cursor-pointer hover:text-blue-200">Contact</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section style="background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.primary} 100%); color: white; padding: 64px 20px; text-align: center;">
                        <div class="max-w-4xl mx-auto px-4">
                            <div style="font-size: 64px; margin-bottom: 24px;">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Quality Workmanship</h2>
                            <p class="text-xl mb-8 opacity-90">Licensed, insured, and guaranteed work</p>
                            <button style="background: white; color: ${colors.primary}; padding: 12px 32px; border-radius: 9999px; font-weight: 600; border: none; cursor: pointer; transition: background 0.3s ease;">
                                Get Free Quote
                            </button>
                        </div>
                    </section>
                    
                    <!-- Services -->
                    <section class="py-16">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Services</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">🏠</div>
                                    <h4 class="font-semibold mb-2">Residential</h4>
                                    <p class="text-gray-600 text-sm">Home repairs and renovations</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">🏢</div>
                                    <h4 class="font-semibold mb-2">Commercial</h4>
                                    <p class="text-gray-600 text-sm">Business and office work</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">🚨</div>
                                    <h4 class="font-semibold mb-2">Emergency</h4>
                                    <p class="text-gray-600 text-sm">24/7 emergency service</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateConsultingLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header style="background: ${colors.primary}; color: white; padding: 1rem;">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Services</span>
                                <span class="cursor-pointer hover:text-blue-200">Case Studies</span>
                                <span class="cursor-pointer hover:text-blue-200">Team</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section style="background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.primary} 100%); color: white; padding: 64px 20px; text-align: center;">
                        <div class="max-w-4xl mx-auto px-4">
                            <div style="font-size: 64px; margin-bottom: 24px;">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Strategic Business Solutions</h2>
                            <p class="text-xl mb-8 opacity-90">Expert consulting to drive your business growth</p>
                            <button style="background: white; color: ${colors.primary}; padding: 12px 32px; border-radius: 9999px; font-weight: 600; border: none; cursor: pointer; transition: background 0.3s ease;">
                                Schedule Consultation
                            </button>
                        </div>
                    </section>
                    
                    <!-- Expertise Areas -->
                    <section class="py-16 bg-gray-50">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Expertise</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="bg-white p-8 rounded-lg shadow-md accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">📈</div>
                                    <h4 class="font-semibold mb-3 text-lg">Business Strategy</h4>
                                    <p class="text-gray-600 mb-4">Comprehensive strategic planning and execution</p>
                                    <ul class="text-gray-600 text-sm space-y-1">
                                        <li>• Market analysis</li>
                                        <li>• Competitive positioning</li>
                                        <li>• Growth strategies</li>
                                    </ul>
                                </div>
                                <div class="bg-white p-8 rounded-lg shadow-md accent-element" style="border-left: 4px solid ${colors.secondary};">
                                    <div style="font-size: 48px; margin-bottom: 16px;">💼</div>
                                    <h4 class="font-semibold mb-3 text-lg">Digital Transformation</h4>
                                    <p class="text-gray-600 mb-4">Modernize your business with technology</p>
                                    <ul class="text-gray-600 text-sm space-y-1">
                                        <li>• Process optimization</li>
                                        <li>• Technology integration</li>
                                        <li>• Change management</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateEducationLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header class="bg-${colors.primary} text-white p-4">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Programs</span>
                                <span class="cursor-pointer hover:text-blue-200">Faculty</span>
                                <span class="cursor-pointer hover:text-blue-200">Admissions</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section class="bg-gradient-to-r from-${colors.primary} to-${colors.primary} text-white py-16 text-center">
                        <div class="max-w-4xl mx-auto px-4">
                            <div class="text-6xl mb-6">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Empowering Minds</h2>
                            <p class="text-xl mb-8 opacity-90">Building futures through education</p>
                            <button class="bg-white text-${colors.primary} px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                                Apply Now
                            </button>
                        </div>
                    </section>
                    
                    <!-- Programs -->
                    <section class="py-16 bg-gray-50">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Programs</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">📚</div>
                                    <h4 class="font-semibold mb-2">Higher Education</h4>
                                    <p class="text-gray-600 text-sm">Bachelor's and Master's degrees</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">🎯</div>
                                    <h4 class="font-semibold mb-2">Professional Development</h4>
                                    <p class="text-gray-600 text-sm">Career advancement courses</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">🌐</div>
                                    <h4 class="font-semibold mb-2">Online Courses</h4>
                                    <p class="text-gray-600 text-sm">Flexible learning options</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateRealEstateLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header class="bg-${colors.primary} text-white p-4">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Properties</span>
                                <span class="cursor-pointer hover:text-blue-200">Agents</span>
                                <span class="cursor-pointer hover:text-blue-200">Contact</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section class="bg-gradient-to-r from-${colors.primary} to-${colors.primary} text-white py-16 text-center">
                        <div class="max-w-4xl mx-auto px-4">
                            <div class="text-6xl mb-6">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Find Your Dream Home</h2>
                            <p class="text-xl mb-8 opacity-90">Expert real estate services</p>
                            <button class="bg-white text-${colors.primary} px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                                Search Properties
                            </button>
                        </div>
                    </section>
                    
                    <!-- Featured Properties -->
                    <section class="py-16">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Featured Properties</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white rounded-lg overflow-hidden shadow-md">
                                    <div class="h-48 bg-gray-200 flex items-center justify-center text-4xl">🏠</div>
                                    <div class="p-6">
                                        <h4 class="font-semibold mb-2">Modern Family Home</h4>
                                        <p class="text-gray-600 text-sm mb-3">3 bed, 2 bath, 1,500 sq ft</p>
                                        <p class="text-${colors.primary} font-bold">$450,000</p>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg overflow-hidden shadow-md">
                                    <div class="h-48 bg-gray-200 flex items-center justify-center text-4xl">🏢</div>
                                    <div class="p-6">
                                        <h4 class="font-semibold mb-2">Downtown Condo</h4>
                                        <p class="text-gray-600 text-sm mb-3">2 bed, 1 bath, 900 sq ft</p>
                                        <p class="text-${colors.primary} font-bold">$280,000</p>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg overflow-hidden shadow-md">
                                    <div class="h-48 bg-gray-200 flex items-center justify-center text-4xl">🏡</div>
                                    <div class="p-6">
                                        <h4 class="font-semibold mb-2">Luxury Estate</h4>
                                        <p class="text-gray-600 text-sm mb-3">5 bed, 4 bath, 3,200 sq ft</p>
                                        <p class="text-${colors.primary} font-bold">$1,200,000</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateTechnologyLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header class="bg-${colors.primary} text-white p-4">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Products</span>
                                <span class="cursor-pointer hover:text-blue-200">Solutions</span>
                                <span class="cursor-pointer hover:text-blue-200">Support</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section class="bg-gradient-to-r from-${colors.primary} to-${colors.primary} text-white py-16 text-center">
                        <div class="max-w-4xl mx-auto px-4">
                            <div class="text-6xl mb-6">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Innovation at Your Fingertips</h2>
                            <p class="text-xl mb-8 opacity-90">Cutting-edge technology solutions</p>
                            <button class="bg-white text-${colors.primary} px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                                Get Started
                            </button>
                        </div>
                    </section>
                    
                    <!-- Solutions -->
                    <section class="py-16 bg-gray-50">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Solutions</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">🚀</div>
                                    <h4 class="font-semibold mb-2">SaaS Solutions</h4>
                                    <p class="text-gray-600 text-sm">Cloud-based software platforms</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">📱</div>
                                    <h4 class="font-semibold mb-2">Mobile Apps</h4>
                                    <p class="text-gray-600 text-sm">iOS and Android development</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">☁️</div>
                                    <h4 class="font-semibold mb-2">Cloud Services</h4>
                                    <p class="text-gray-600 text-sm">Scalable cloud infrastructure</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }
        
        function generateDefaultLayout(template, colors) {
            return `
                <div class="bg-white text-gray-800 font-sans">
                    <!-- Header -->
                    <header class="bg-${colors.primary} text-white p-4">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${template.name}</h1>
                                <p class="text-sm opacity-90">${template.tagline}</p>
                            </div>
                            <nav class="flex space-x-6 text-sm">
                                <span class="cursor-pointer hover:text-blue-200">Home</span>
                                <span class="cursor-pointer hover:text-blue-200">Services</span>
                                <span class="cursor-pointer hover:text-blue-200">About</span>
                                <span class="cursor-pointer hover:text-blue-200">Contact</span>
                            </nav>
                        </div>
                    </header>
                    
                    <!-- Hero Section -->
                    <section class="bg-gradient-to-r from-${colors.primary} to-${colors.primary} text-white py-16 text-center">
                        <div class="max-w-4xl mx-auto px-4">
                            <div class="text-6xl mb-6">${template.heroImage}</div>
                            <h2 class="text-3xl font-bold mb-4">Professional Solutions</h2>
                            <p class="text-xl mb-8 opacity-90">Quality service for your business needs</p>
                            <button class="bg-white text-${colors.primary} px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                                Learn More
                            </button>
                        </div>
                    </section>
                    
                    <!-- Services -->
                    <section class="py-16 bg-gray-50">
                        <div class="max-w-6xl mx-auto px-4">
                            <h3 class="text-2xl font-bold text-center mb-12 text-gray-800">Our Services</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">🎯</div>
                                    <h4 class="font-semibold mb-2">Service 1</h4>
                                    <p class="text-gray-600 text-sm">Professional service description</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">⚡</div>
                                    <h4 class="font-semibold mb-2">Service 2</h4>
                                    <p class="text-gray-600 text-sm">Fast and reliable solutions</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                    <div class="text-4xl mb-4">💡</div>
                                    <h4 class="font-semibold mb-2">Service 3</h4>
                                    <p class="text-gray-600 text-sm">Innovative solutions</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer class="bg-gray-800 text-white py-8 text-center">
                        <p>&copy; 2024 ${template.name}. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }

        // --- Modular Section Generators ---
        function renderHeroSection(template, colors, designStyle, businessName) {
            return `
                <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                    <div style="font-size: 64px; margin-bottom: 20px;">${template.heroImage}</div>
                    <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;">${businessName}</h1>
                    <p style="font-size: 1.25rem; margin-bottom: 30px; opacity: 0.9;">${template.tagline}</p>
                    <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Learn More</button>
                </section>
            `;
        }

        function renderFeaturesSection(template, colors) {
            return `
                <section style="padding: 40px 20px; background: #fff;">
                    <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Features</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        ${template.features.map((feature, i) => `
                            <div style="background: ${colors.accent}; border-radius: 10px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">${template.icons[i % template.icons.length]}</div>
                                <div style="font-weight: bold; margin-bottom: 5px;">${feature}</div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderTestimonialsSection(colors) {
            return `
                <section style="padding: 40px 20px; background: #f9f9f9;">
                    <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Testimonials</h2>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 350px;">
                            <div style="color: ${colors.primary}; font-size: 24px; margin-bottom: 10px;">⭐⭐⭐⭐⭐</div>
                            <p style="color: #666; font-style: italic; margin-bottom: 15px;">"Amazing service and support! Highly recommend."</p>
                            <div style="font-weight: bold;">- Alex P.</div>
                        </div>
                        <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 350px;">
                            <div style="color: ${colors.primary}; font-size: 24px; margin-bottom: 10px;">⭐⭐⭐⭐⭐</div>
                            <p style="color: #666; font-style: italic; margin-bottom: 15px;">"Professional and reliable every time."</p>
                            <div style="font-weight: bold;">- Jamie L.</div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderFooterSection(template, colors, businessName) {
            return `
                <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: bold; margin-bottom: 10px;">${businessName}</div>
                        <div style="font-size: 14px; opacity: 0.8;">123 Main St, City, State</div>
                        <div style="font-size: 14px; opacity: 0.8;">(555) 123-4567</div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.6;">© 2025 ${businessName}. All rights reserved.</div>
                </footer>
            `;
        }

        // --- Additional Layout Functions ---
        
        function generateServiceLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <!-- Service Header -->
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Services</span>
                            <span style="cursor: pointer; padding: 5px 10px;">About</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Contact</span>
                        </nav>
                    </header>
                    
                    <!-- Hero Section -->
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Professional Services</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Quality workmanship you can trust</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Get Quote</button>
                    </section>
                    
                    <!-- Services Grid -->
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Services</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🔧</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Repair Services</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Fast and reliable repair solutions</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">From $50</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">⚡</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Emergency Service</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">24/7 emergency response</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Call Now</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">📋</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Maintenance</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Preventive maintenance plans</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Monthly Plans</div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Why Choose Us -->
                    <section style="background: #f9f9f9; padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Why Choose Us</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">⭐</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">5-Star Rated</h3>
                                <p style="color: #666; font-size: 14px;">Consistently excellent reviews</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">🕒</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">Fast Response</h3>
                                <p style="color: #666; font-size: 14px;">Same-day service available</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">💯</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">Guaranteed</h3>
                                <p style="color: #666; font-size: 14px;">100% satisfaction guarantee</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">789 Service St, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 456-7890</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateConsultingLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <!-- Consulting Header -->
                    <header style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -40)}); color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Services</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Case Studies</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Team</span>
                        </nav>
                    </header>
                    
                    <!-- Hero Section -->
                    <section style="background: linear-gradient(45deg, ${colors.primary}, ${adjustColor(colors.primary, -20)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Strategic Business Solutions</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Expert consulting to drive your business growth</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Schedule Consultation</button>
                    </section>
                    
                    <!-- Expertise Areas -->
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Expertise</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                            <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div style="font-size: 36px; margin-bottom: 15px;">📈</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Business Strategy</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Comprehensive strategic planning and execution</p>
                                <ul style="color: #666; font-size: 14px; padding-left: 20px;">
                                    <li>Market analysis</li>
                                    <li>Competitive positioning</li>
                                    <li>Growth strategies</li>
                                </ul>
                            </div>
                            <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div style="font-size: 36px; margin-bottom: 15px;">💼</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Digital Transformation</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Modernize your business with technology</p>
                                <ul style="color: #666; font-size: 14px; padding-left: 20px;">
                                    <li>Process optimization</li>
                                    <li>Technology integration</li>
                                    <li>Change management</li>
                                </ul>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Process -->
                    <section style="background: #f9f9f9; padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Process</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center;">
                                <div style="width: 60px; height: 60px; background: ${colors.primary}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">1</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">Discovery</h3>
                                <p style="color: #666; font-size: 14px;">Understanding your needs</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 60px; height: 60px; background: ${colors.primary}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">2</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">Strategy</h3>
                                <p style="color: #666; font-size: 14px;">Developing solutions</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 60px; height: 60px; background: ${colors.primary}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">3</div>
                                <h3 style="margin-bottom: 5px; font-weight: bold;">Implementation</h3>
                                <p style="color: #666; font-size: 14px;">Executing the plan</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Footer -->
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">321 Business Ave, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 789-0123</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateHealthLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Services</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Providers</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Appointments</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Your Health Journey</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Comprehensive wellness care for you and your family</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Book Appointment</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Services</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🏥</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Primary Care</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Comprehensive health checkups</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Schedule Today</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🧘</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Wellness Programs</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Holistic health solutions</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">📱</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Telemedicine</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Virtual consultations available</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Start Visit</div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">456 Health Blvd, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 234-5678</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateTradesLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Services</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Gallery</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Contact</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Quality Workmanship</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Licensed, insured, and guaranteed work</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Get Free Quote</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Services</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🏠</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Residential</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Home repairs and renovations</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🏢</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Commercial</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Business and office work</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🚨</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Emergency</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">24/7 emergency service</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Call Now</div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">789 Trade St, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 345-6789</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateNonprofitLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Programs</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Donate</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Volunteer</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Making a Difference</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Join us in creating positive change</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Donate Now</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Programs</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">💝</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Community Service</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Supporting local communities</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">📖</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Education</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Empowering through knowledge</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🌱</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Environmental</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Protecting our planet</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">321 Impact Way, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 456-7890</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateEducationLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Programs</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Faculty</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Admissions</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Empowering Minds</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Building futures through education</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Apply Now</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Programs</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">📚</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Higher Education</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Bachelor's and Master's degrees</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🎯</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Professional Development</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Career advancement courses</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🌐</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Online Courses</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Flexible learning options</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">654 Education Dr, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 567-8901</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateRealEstateLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Properties</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Agents</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Contact</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Find Your Dream Home</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Expert real estate services</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;">Search Properties</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Featured Properties</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div style="height: 150px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 48px;">🏠</div>
                                <div style="padding: 15px;">
                                    <h3 style="margin-bottom: 5px; font-weight: bold;">Modern Family Home</h3>
                                    <p style="color: #666; font-size: 14px; margin-bottom: 10px;">3 bed, 2 bath, 1,500 sq ft</p>
                                    <div style="color: ${colors.primary}; font-weight: bold;">$450,000</div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div style="height: 150px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 48px;">🏢</div>
                                <div style="padding: 15px;">
                                    <h3 style="margin-bottom: 5px; font-weight: bold;">Downtown Condo</h3>
                                    <p style="color: #666; font-size: 14px; margin-bottom: 10px;">2 bed, 1 bath, 900 sq ft</p>
                                    <div style="color: ${colors.primary}; font-weight: bold;">$280,000</div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <div style="height: 150px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 48px;">🏡</div>
                                <div style="padding: 15px;">
                                    <h3 style="margin-bottom: 5px; font-weight: bold;">Luxury Estate</h3>
                                    <p style="color: #666; font-size: 14px; margin-bottom: 10px;">5 bed, 4 bath, 3,200 sq ft</p>
                                    <div style="color: ${colors.primary}; font-weight: bold;">$1,200,000</div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">987 Real Estate Blvd, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 678-9012</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }
        
        function generateTechnologyLayout(template, colors, designStyle, businessName, navItems, hasBooking, hasStore, hasBlog, hasTestimonials, hasContact, hasAnalytics, hasLiveChat, hasPayment, hasScheduler, hasDashboard, hasSocial, hasMobile, pagesCore, pagesEngage) {
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; line-height: 1.6;">
                    <header style="background: ${colors.primary}; color: white; padding: 20px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${template.name}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${template.tagline}</div>
                        <nav style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; font-size: 12px;">
                            <span style="cursor: pointer; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.2);">Home</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Products</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Solutions</span>
                            <span style="cursor: pointer; padding: 5px 10px;">Support</span>
                        </nav>
                    </header>
                    
                    <section style="background: linear-gradient(135deg, ${colors.primary}, ${adjustColor(colors.primary, -30)}); color: white; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">${template.heroImage}</div>
                        <h1 style="font-size: 28px; margin-bottom: 10px; font-weight: bold;">Innovation at Your Fingertips</h1>
                        <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">Cutting-edge technology solutions</p>
                        <button style="background: white; color: ${colors.primary}; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor:  pointer;">Get Started</button>
                    </section>
                    
                    <section style="padding: 40px 20px;">
                        <h2 style="text-align: center; margin-bottom: 30px; color: ${colors.primary}; font-size: 24px;">Our Solutions</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">🚀</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">SaaS Solutions</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Cloud-based software platforms</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">📱</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Mobile Apps</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">iOS and Android development</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: 15px;">☁️</div>
                                <h3 style="margin-bottom: 10px; font-weight: bold;">Cloud Services</h3>
                                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Scalable cloud infrastructure</p>
                                <div style="color: ${colors.primary}; font-weight: bold;">Learn More</div>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 30px 20px; text-align: center;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${template.name}</div>
                            <div style="font-size: 14px; opacity: 0.8;">159 Tech Park, City, State</div>
                            <div style="font-size: 14px; opacity: 0.8;">(555) 789-0123</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.6;">© 2024 ${template.name}. All rights reserved.</div>
                    </footer>
                </div>
            `;
        }

        // --- Utility Functions ---
        function adjustColor(color, amount) {
            const hex = color.replace('#', '');
            const num = parseInt(hex, 16);
            const r = Math.min(255, Math.max(0, (num >> 16) + amount));
            const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
            const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
            return '#' + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
        }

    function renderSummary() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('admin') === 'true') {
            return `<pre class='text-xs whitespace-pre-wrap break-all'>${JSON.stringify(formData, null, 2)}</pre>`;
        }
        
        const businessName = formData.businessName || 'Your Business';
        const businessType = formData.businessType || 'Not specified';
        const goals = formData.goals && formData.goals.length > 0 ? formData.goals.join(', ') : 'Not specified';
        const designStyle = formData.designStyle || 'Not specified';
        const budget = formData.budget || 'Not specified';
        const timeline = formData.timeline || 'Not specified';
        
        // Calculate estimated cost
        const estimatedCost = calculateEstimatedCost();
        
        return `
            <div class="text-white">
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-full mb-4">
                        <i class="fas fa-check text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-2">Website Vision Summary</h3>
                    <p class="text-text-muted">Review your selections before submitting</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Business Information -->
                    <div class="space-y-4">
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-building"></i>
                                Business Information
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Business Name:</strong> ${businessName}</div>
                                <div><strong>Business Type:</strong> ${businessType}</div>
                                ${formData.businessDescription ? `<div><strong>Description:</strong> ${formData.businessDescription.substring(0, 100)}${formData.businessDescription.length > 100 ? '...' : ''}</div>` : ''}
                            </div>
                        </div>
                        
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-target"></i>
                                Website Goals
                            </h4>
                            <div class="text-sm">${goals}</div>
                        </div>
                        
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-palette"></i>
                                Design Preferences
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Style:</strong> ${designStyle}</div>
                                <div><strong>Primary Color:</strong> 
                                    <span class="inline-block w-4 h-4 rounded-full mr-2" style="background: ${formData.primaryColor || '#3abbfa'}"></span>
                                    ${formData.primaryColor || '#3abbfa'}
                                </div>
                                <div><strong>Secondary Color:</strong> 
                                    <span class="inline-block w-4 h-4 rounded-full mr-2" style="background: ${formData.secondaryColor || '#f39c12'}"></span>
                                    ${formData.secondaryColor || '#f39c12'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Project Details -->
                    <div class="space-y-4">
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-list"></i>
                                Selected Pages
                            </h4>
                            <div class="space-y-2 text-sm">
                                ${formData.pagesCore && formData.pagesCore.length > 0 ? `<div><strong>Core:</strong> ${formData.pagesCore.join(', ')}</div>` : ''}
                                ${formData.pagesTrust && formData.pagesTrust.length > 0 ? `<div><strong>Trust:</strong> ${formData.pagesTrust.join(', ')}</div>` : ''}
                                ${formData.pagesEngage && formData.pagesEngage.length > 0 ? `<div><strong>Engagement:</strong> ${formData.pagesEngage.join(', ')}</div>` : ''}
                                ${formData.pagesCommerce && formData.pagesCommerce.length > 0 ? `<div><strong>Commerce:</strong> ${formData.pagesCommerce.join(', ')}</div>` : ''}
                            </div>
                        </div>
                        
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-cogs"></i>
                                Features
                            </h4>
                            <div class="text-sm">${formData.features && formData.features.length > 0 ? formData.features.join(', ') : 'No features selected'}</div>
                        </div>
                        
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-dollar-sign"></i>
                                Project Details
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Budget:</strong> ${budget}</div>
                                <div><strong>Timeline:</strong> ${timeline}</div>
                                <div><strong>Estimated Cost:</strong> <span class="text-green-400 font-semibold">${estimatedCost}</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-dark-light rounded-lg p-4">
                            <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
                                <i class="fas fa-user"></i>
                                Contact Information
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Name:</strong> ${formData.contactName || 'Not provided'}</div>
                                <div><strong>Email:</strong> ${formData.email || 'Not provided'}</div>
                                <div><strong>Phone:</strong> ${formData.phone || 'Not provided'}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-lg">
                    <p class="text-center text-sm text-text-muted">
                        <i class="fas fa-info-circle mr-2"></i>
                        We'll review your requirements and get back to you with a custom proposal within 24 hours.
                    </p>
                </div>
            </div>
        `;
    }

                // --- Navigation ---
        function goToStep(idx) {
            currentStep = idx;
            
            // Enable preview when moving to Step 2 (business type selection)
            if (idx === 1 && !previewEnabled) {
                previewEnabled = true;
                updatePreviewVisibility();
            }
            
            renderStep(currentStep);
            updatePreview();
        }

        function nextStep() {
            if (!validateStep(currentStep)) return;
            goToStep(currentStep + 1);
        }

        function prevStep() {
            goToStep(currentStep - 1);
        }

    function validateStep(idx) {
        const step = wizardSteps[idx];
        let valid = true;
        step.fields.forEach(field => {
            if (field.required) {
                if (field.type === 'checkbox-group') {
                    if (!formData[field.name] || !formData[field.name].length) valid = false;
                } else if (!formData[field.name]) {
                    valid = false;
                }
            }
        });
        return valid;
    }

        // --- Enhanced Event Handling with Real-Time Visual Changes ---
        document.getElementById('wizardForm').addEventListener('input', function(e) {
            const t = e.target;
            
            // Add visual feedback
            if (t.type === 'checkbox' || t.type === 'radio') {
                const label = t.closest('label');
                if (label) {
                    label.style.transform = 'scale(1.05)';
                    label.style.transition = 'transform 0.2s ease';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            
            // Update form data
            if (t.type === 'checkbox') {
                // Always update formData for any checkbox group
                if (!formData[t.name]) formData[t.name] = [];
                if (t.checked) {
                    if (!formData[t.name].includes(t.value)) formData[t.name].push(t.value);
                } else {
                    formData[t.name] = formData[t.name].filter(v => v !== t.value);
                }
                // For core/trust pages, update selectedPages and preview
                if (t.name === 'pagesCore' || t.name === 'pagesTrust') {
                    updateSelectedPagesFromFormData();
                    updatePreview();
                }
            } else if (t.type === 'radio') {
                formData[t.name] = t.value;
                // Show/hide "Other" input for radio buttons
                if (t.value === 'Other') {
                    const otherInput = document.getElementById(`other-${t.name}`);
                    if (otherInput) otherInput.style.display = 'block';
                } else {
                    const otherInput = document.getElementById(`other-${t.name}`);
                    if (otherInput) otherInput.style.display = 'none';
                }
            } else if (t.type === 'text' && (t.name === 'primaryColor' || t.name === 'secondaryColor')) {
                // Handle color text input validation and sync
                const hexRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
                if (hexRegex.test(t.value)) {
                    // Sync the color picker with the text input
                    const colorInput = document.querySelector(`input[type="color"][name="${t.name}"]`);
                    if (colorInput) {
                        colorInput.value = t.value;
                    }
                    formData[t.name] = t.value;
                    // Update colors immediately for color inputs
                    updateColorsImmediately(t.name, t.value);
                }
            } else {
                formData[t.name] = t.value;
            }
            
            // For color inputs, handle separately to avoid conflicts
            if (t.type === 'text' && (t.name === 'primaryColor' || t.name === 'secondaryColor')) {
                // Colors are handled by updateColorsImmediately, no need for full preview update
                return;
            }
            
            // IMMEDIATE visual feedback for specific options (but not for colors)
            handleImmediateVisualChanges(t);
            
            // Update preview with delay for better UX
            clearTimeout(window.previewTimeout);
            window.previewTimeout = setTimeout(() => {
                updatePreview();
            }, 200);
        });
        
        // Handle checkbox changes for "Other" options
        document.getElementById('wizardForm').addEventListener('change', function(e) {
            const t = e.target;
            
            if (t.type === 'checkbox' && t.value === 'Other') {
                const otherInput = document.getElementById(`other-${t.name}`);
                if (otherInput) {
                    otherInput.style.display = t.checked ? 'block' : 'none';
                }
            }
            
            // Handle toggle switches
            if (t.type === 'checkbox' && t.name === 'sendEmailCopy') {
                formData[t.name] = t.checked;
            }
            
            // Handle color picker changes
            if (t.type === 'color') {
                // Sync the text input with the color picker
                const textInput = document.querySelector(`input[type="text"][name="${t.name}"]`);
                if (textInput) {
                    textInput.value = t.value;
                }
                formData[t.name] = t.value;
                updateColorsImmediately(t.name, t.value);
                // Don't trigger full preview update for color changes
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        });
        

        
        // --- Handle Immediate Visual Changes for Each Option ---
        function handleImmediateVisualChanges(target) {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Business Type Changes
            if (target.name === 'businessType' && target.value) {
                const template = previewTemplates[target.value];
                if (template) {
                    // Immediately change the hero emoji and color
                    const heroSection = previewContent.querySelector('section[style*="padding: 60px"]');
                    if (heroSection) {
                        const emojiDiv = heroSection.querySelector('div[style*="font-size: 64px"]');
                        if (emojiDiv) {
                            emojiDiv.innerHTML = template.heroImage;
                            emojiDiv.style.animation = 'none';
                            setTimeout(() => {
                                emojiDiv.style.animation = 'float 3s ease-in-out infinite';
                            }, 10);
                        }
                    }
                    
                    // Change header color immediately
                    const header = previewContent.querySelector('header');
                    if (header) {
                        const currentPrimaryColor = formData.primaryColor || '#3abbfa';
                        header.style.background = currentPrimaryColor;
                        header.style.transition = 'background 0.5s ease';
                    }
                }
            }
            
            // Pages Changes - Update navigation dynamically
            if (target.name && target.name.startsWith('pages')) {
                updateNavigationDynamically();
            }
            
            // Features Changes - REMOVE add/remove feature sections here
            // Design Style Changes - Immediate visual updates
            if (target.name === 'designStyle') {
                applyDesignStyleImmediately(target.value);
            }
            
            // Color Changes - Immediate color updates
            if (target.name === 'primaryColor' || target.name === 'secondaryColor') {
                updateColorsImmediately(target.name, target.value);
            }
        }
        
        // --- Dynamic Navigation Updates ---
        function updateNavigationDynamically() {
            const preview = document.getElementById('sitePreview');
            const nav = preview.querySelector('nav');
            if (!nav) return;
            
            const navContainer = nav.querySelector('div:first-child');
            const currentItems = navContainer.querySelectorAll('span');
            
            // Remove all current items except Home
            currentItems.forEach(item => {
                if (item.textContent !== 'Home') {
                    item.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => item.remove(), 300);
                }
            });
            
            // Add new items based on selections
            setTimeout(() => {
                if (formData.pagesCore && formData.pagesCore.includes('About')) {
                    addNavItem('About', navContainer);
                }
                if (formData.pagesCore && formData.pagesCore.includes('Services')) {
                    addNavItem('Services', navContainer);
                }
                if (formData.pagesCore && formData.pagesCore.includes('Contact')) {
                    addNavItem('Contact', navContainer);
                }
                if (formData.pagesEngage && formData.pagesEngage.includes('Blog')) {
                    addNavItem('Blog', navContainer);
                }
                if (formData.pagesTrust && formData.pagesTrust.includes('Testimonials')) {
                    addNavItem('Reviews', navContainer);
                }
            }, 350);
        }
        
        function addNavItem(text, container) {
            const item = document.createElement('span');
            item.textContent = text;
            item.style.cssText = 'font-weight: 400; cursor: pointer; transition: color 0.3s; animation: slideIn 0.3s ease;';
            item.style.marginRight = '20px';
            container.appendChild(item);
        }
        
        // --- Add Dynamic Sections ---
        function addPortfolioSection() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Remove existing portfolio section
            const existing = previewContent.querySelector('.portfolio-section');
            if (existing) existing.remove();
            
            const portfolioSection = document.createElement('section');
            portfolioSection.className = 'portfolio-section';
            portfolioSection.style.cssText = 'padding: 40px 20px; background: #f8f9fa; animation: slideIn 0.5s ease;';
            
            portfolioSection.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <h3 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 24px;">Our Portfolio</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="height: 150px; background: linear-gradient(45deg, #3abbfa, #2a9ee0); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">📸</div>
                            <div style="padding: 20px;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">Project 1</h4>
                                <p style="margin: 0; color: #666; font-size: 14px;">Amazing project description</p>
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="height: 150px; background: linear-gradient(45deg, #f39c12, #e67e22); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">🎨</div>
                            <div style="padding: 20px;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">Project 2</h4>
                                <p style="margin: 0; color: #666; font-size: 14px;">Creative design showcase</p>
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="height: 150px; background: linear-gradient(45deg, #2ecc71, #27ae60); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">💻</div>
                            <div style="padding: 20px;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">Project 3</h4>
                                <p style="margin: 0; color: #666; font-size: 14px;">Technical implementation</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert before footer
            const footer = previewContent.querySelector('footer');
            if (footer) {
                footer.parentNode.insertBefore(portfolioSection, footer);
            }
        }
        
        function addAnalyticsSection() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Remove existing analytics section
            const existing = previewContent.querySelector('.analytics-section');
            if (existing) existing.remove();
            
            const analyticsSection = document.createElement('section');
            analyticsSection.className = 'analytics-section';
            analyticsSection.style.cssText = 'padding: 40px 20px; background: #3abbfa; color: white; animation: slideIn 0.5s ease;';
            
            analyticsSection.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
                    <h3 style="margin-bottom: 30px; font-size: 24px;">📊 Analytics Dashboard</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 30px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <div style="font-size: 36px; font-weight: bold; margin-bottom: 5px;">1.2K</div>
                            <div style="font-size: 14px; opacity: 0.9;">Monthly Visitors</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <div style="font-size: 36px; font-weight: bold; margin-bottom: 5px;">85%</div>
                            <div style="font-size: 14px; opacity: 0.9;">Conversion Rate</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <div style="font-size: 36px; font-weight: bold; margin-bottom: 5px;">$12K</div>
                            <div style="font-size: 14px; opacity: 0.9;">Monthly Revenue</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert before footer
            const footer = previewContent.querySelector('footer');
            if (footer) {
                footer.parentNode.insertBefore(analyticsSection, footer);
            }
        }
        
        function removeAnalyticsSection() {
            const analyticsSection = document.querySelector('.analytics-section');
            if (analyticsSection) {
                analyticsSection.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => analyticsSection.remove(), 300);
            }
        }
        
        function addLiveChatWidget() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Remove existing chat widget
            const existing = previewContent.querySelector('.chat-widget');
            if (existing) existing.remove();
            
            const chatWidget = document.createElement('div');
            chatWidget.className = 'chat-widget';
            chatWidget.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #3abbfa; color: white; padding: 15px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); animation: slideIn 0.3s ease; z-index: 1000;';
            chatWidget.innerHTML = '💬 Chat with us!';
            
            previewContent.appendChild(chatWidget);
        }
        
        function removeLiveChatWidget() {
            const chatWidget = document.querySelector('.chat-widget');
            if (chatWidget) {
                chatWidget.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => chatWidget.remove(), 300);
            }
        }
        
        function addNewsletterSection() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Remove existing newsletter section
            const existing = previewContent.querySelector('.newsletter-section');
            if (existing) existing.remove();
            
            const newsletterSection = document.createElement('section');
            newsletterSection.className = 'newsletter-section';
            newsletterSection.style.cssText = 'padding: 40px 20px; background: #f8f9fa; animation: slideIn 0.5s ease;';
            
            newsletterSection.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <h3 style="margin-bottom: 20px; color: #333; font-size: 24px;">📧 Stay Updated</h3>
                    <p style="margin-bottom: 30px; color: #666;">Get the latest updates and exclusive offers!</p>
                    <div style="display: flex; gap: 10px; justify-content: center; max-width: 400px; margin: 0 auto;">
                        <input type="email" placeholder="Enter your email" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        <button style="background: #3abbfa; color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">Subscribe</button>
                    </div>
                </div>
            `;
            
            // Insert before footer
            const footer = previewContent.querySelector('footer');
            if (footer) {
                footer.parentNode.insertBefore(newsletterSection, footer);
            }
        }
        
        function removeNewsletterSection() {
            const newsletterSection = document.querySelector('.newsletter-section');
            if (newsletterSection) {
                newsletterSection.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => newsletterSection.remove(), 300);
            }
        }
        
        // --- Apply Design Style Immediately ---
        function applyDesignStyleImmediately(style) {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            const isModern = style.includes('Modern');
            const isBold = style.includes('Bold');
            const isProfessional = style.includes('Professional');
            const isWarm = style.includes('Warm');
            const isMinimalist = style.includes('Minimalist');
            const isLuxury = style.includes('Luxury');
            
            // Update header style - respect user's selected primary color
            const header = previewContent.querySelector('header');
            if (header) {
                const userPrimaryColor = formData.primaryColor || '#3abbfa';
                if (isModern) {
                    header.style.background = `linear-gradient(135deg, ${userPrimaryColor}, ${userPrimaryColor})`;
                } else if (isLuxury) {
                    header.style.background = `linear-gradient(45deg, ${userPrimaryColor}, ${userPrimaryColor}, ${userPrimaryColor})`;
                } else if (isMinimalist) {
                    header.style.background = userPrimaryColor;
                } else {
                    header.style.background = userPrimaryColor;
                }
                header.style.transition = 'background 0.5s ease';
            }
            
            // Update typography
            const headings = previewContent.querySelectorAll('h1, h2, h3');
            headings.forEach(heading => {
                if (isBold) {
                    heading.style.fontWeight = '800';
                    heading.style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
                } else {
                    heading.style.fontWeight = '600';
                    heading.style.textShadow = 'none';
                }
            });
            
            // Update card styles
            const cards = previewContent.querySelectorAll('div[style*="border-radius"]');
            cards.forEach(card => {
                if (isMinimalist) {
                    card.style.border = 'none';
                    card.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                } else if (isLuxury) {
                    card.style.border = '1px solid #ddd';
                    card.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                }
            });
        }
        
        // --- Update Colors Immediately ---
        function updateColorsImmediately(colorType, color) {
            console.log(`Updating ${colorType} to ${color}`);
            console.log('Current formData colors:', { primary: formData.primaryColor, secondary: formData.secondaryColor });
            
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Ensure formData is updated with the new color
            formData[colorType] = color;
            
            // Get both colors from form data (now with updated value)
            const primaryColor = formData.primaryColor || '#3abbfa';
            const secondaryColor = formData.secondaryColor || '#f39c12';
            
            console.log('After update - formData colors:', { primary: primaryColor, secondary: secondaryColor });
            
            if (colorType === 'primaryColor') {
                console.log(`Applying primary color: ${color}`);
                // Update header with primary color
                const header = previewContent.querySelector('header');
                if (header) {
                    header.style.background = color;
                    header.style.transition = 'background 0.5s ease';
                }
                
                // Update main CTA buttons with primary color
                const buttons = previewContent.querySelectorAll('button');
                buttons.forEach(button => {
                    if (button.style.background !== 'transparent' && !button.classList.contains('secondary-btn')) {
                        button.style.background = color;
                        button.style.transition = 'background 0.3s ease';
                    }
                });
                
                // Update hero section background
                const heroSection = previewContent.querySelector('section[style*="padding: 60px"], section[style*="padding: 64px"]');
                if (heroSection) {
                    heroSection.style.background = `linear-gradient(135deg, ${color} 0%, ${color} 100%)`;
                    heroSection.style.transition = 'background 0.5s ease';
                }
                
            } else if (colorType === 'secondaryColor') {
                console.log(`Applying secondary color: ${color}`);
                // Update secondary elements with secondary color
                const secondaryButtons = previewContent.querySelectorAll('button.secondary-btn');
                secondaryButtons.forEach(button => {
                    button.style.background = color;
                    button.style.transition = 'background 0.3s ease';
                });
                
                // Update accent elements like icons and highlights
                const accentElements = previewContent.querySelectorAll('.accent-element, [style*="border-left"]');
                accentElements.forEach(element => {
                    element.style.borderColor = color;
                    element.style.transition = 'border-color 0.3s ease';
                });
                
                // Update feature icons with secondary color
                const featureIcons = previewContent.querySelectorAll('div[style*="font-size: 48px"], div[style*="font-size: 64px"]');
                featureIcons.forEach(icon => {
                    const parent = icon.parentElement;
                    if (parent && parent.style.borderRadius) {
                        parent.style.border = `2px solid ${color}`;
                        parent.style.transition = 'border-color 0.3s ease';
                    }
                });
            }
            
            // Add color change animation
            addColorChangeEffect(color);
            
            // Ensure colors persist by setting a flag
            previewContent.setAttribute('data-colors-updated', 'true');
            previewContent.setAttribute('data-primary-color', primaryColor);
            previewContent.setAttribute('data-secondary-color', secondaryColor);
        }
        
        // --- Add Interactive Elements ---
        function addInteractiveElements() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Make navigation items clickable with hover effects
            const navItems = previewContent.querySelectorAll('nav span');
            navItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.addEventListener('mouseenter', function() {
                    this.style.color = '#3abbfa';
                    this.style.transform = 'scale(1.1)';
                    this.style.transition = 'all 0.2s ease';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.color = '';
                    this.style.transform = 'scale(1)';
                });
            });
            
            // Make buttons interactive
            const buttons = previewContent.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });
            
            // Add hover effects to feature cards
            const featureCards = previewContent.querySelectorAll('div[style*="text-align: center"]');
            featureCards.forEach(card => {
                if (card.querySelector('div[style*="font-size: 48px"]')) {
                    card.style.cursor = 'pointer';
                    card.style.transition = 'all 0.3s ease';
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-5px)';
                        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                    });
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = '';
                    });
                }
            });
        }
        
        // --- Add Color Change Effect ---
        function addColorChangeEffect(color) {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Create a temporary overlay for color transition
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: ${color};
                opacity: 0.1;
                pointer-events: none;
                z-index: 10;
                animation: colorFlash 0.5s ease-out;
            `;
            
            previewContent.style.position = 'relative';
            previewContent.appendChild(overlay);
            
            setTimeout(() => {
                overlay.remove();
            }, 500);
        }
        
        // Add color flash animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes colorFlash {
                0% { opacity: 0.3; }
                100% { opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // --- Add Real-time Counter Animations ---
        function animateCounters() {
            const counters = document.querySelectorAll('.analytics-section div[style*="font-size: 36px"]');
            counters.forEach(counter => {
                const target = parseInt(counter.textContent.replace(/[^\d]/g, ''));
                const suffix = counter.textContent.replace(/[\d]/g, '');
                let current = 0;
                const increment = target / 50;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    counter.textContent = Math.floor(current) + suffix;
                }, 20);
            });
        }
        
        // --- Add Loading States ---
        function addLoadingState(element) {
            element.style.opacity = '0.7';
            element.style.pointerEvents = 'none';
            
            const spinner = document.createElement('div');
            spinner.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 20px;
                height: 20px;
                border: 2px solid #f3f3f3;
                border-top: 2px solid #3abbfa;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                z-index: 100;
            `;
            
            element.style.position = 'relative';
            element.appendChild(spinner);
            
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.pointerEvents = 'auto';
                spinner.remove();
            }, 1000);
        }
        
        // Add spin animation
        const spinStyle = document.createElement('style');
        spinStyle.textContent = `
            @keyframes spin {
                0% { transform: translate(-50%, -50%) rotate(0deg); }
                100% { transform: translate(-50%, -50%) rotate(360deg); }
            }
        `;
        document.head.appendChild(spinStyle);
        
        // --- Enhanced Form Interactions ---
        document.getElementById('wizardForm').addEventListener('mouseover', function(e) {
            const target = e.target;
            if (target.tagName === 'LABEL' && target.closest('.space-y-2')) {
                target.style.backgroundColor = 'rgba(58, 187, 250, 0.1)';
                target.style.borderRadius = '8px';
                target.style.transition = 'background-color 0.3s ease';
                target.style.transform = 'translateX(5px)';
            }
        });
        
        document.getElementById('wizardForm').addEventListener('mouseout', function(e) {
            const target = e.target;
            if (target.tagName === 'LABEL' && target.closest('.space-y-2')) {
                target.style.backgroundColor = '';
                target.style.borderRadius = '';
                target.style.transform = 'translateX(0)';
            }
        });
        
        // Add dynamic form validation feedback
        document.getElementById('wizardForm').addEventListener('change', function(e) {
            const target = e.target;
            
            // Checkbox animations
            if (target.type === 'checkbox') {
                const label = target.closest('label');
                if (target.checked) {
                    label.style.background = 'rgba(58, 187, 250, 0.15)';
                    label.style.borderColor = '#3abbfa';
                    label.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                    
                    // Add checkmark animation
                    const checkmark = document.createElement('span');
                    checkmark.innerHTML = '✓';
                    checkmark.style.cssText = `
                        position: absolute;
                        right: 10px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #3abbfa;
                        font-weight: bold;
                        font-size: 18px;
                        animation: checkmarkIn 0.3s ease;
                    `;
                    label.style.position = 'relative';
                    label.appendChild(checkmark);
                    
                    setTimeout(() => {
                        checkmark.remove();
                    }, 1000);
                } else {
                    label.style.background = '';
                    label.style.borderColor = '';
                }
            }
            
            // Radio button animations
            if (target.type === 'radio') {
                const name = target.name;
                const otherRadios = document.querySelectorAll(`input[name="${name}"]`);
                otherRadios.forEach(r => {
                    const rLabel = r.closest('label');
                    if (rLabel) {
                        rLabel.style.background = '';
                        rLabel.style.borderColor = '';
                    }
                });
                
                const label = target.closest('label');
                if (label) {
                    label.style.background = 'rgba(58, 187, 250, 0.15)';
                    label.style.borderColor = '#3abbfa';
                    label.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            
            // Color picker preview
            if (target.type === 'color') {
                const preview = document.getElementById('sitePreview');
                if (preview) {
                    preview.style.borderColor = target.value;
                    preview.style.transition = 'border-color 0.3s ease';
                    
                    // Add color change indicator
                    const indicator = document.createElement('div');
                    indicator.style.cssText = `
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        width: 20px;
                        height: 20px;
                        background: ${target.value};
                        border-radius: 50%;
                        border: 2px solid white;
                        animation: colorPulse 0.5s ease;
                    `;
                    preview.appendChild(indicator);
                    
                    setTimeout(() => {
                        indicator.remove();
                    }, 1000);
                }
            }
        });
        
        // Add checkmark animation
        const checkmarkStyle = document.createElement('style');
        checkmarkStyle.textContent = `
            @keyframes checkmarkIn {
                from { 
                    opacity: 0; 
                    transform: translateY(-50%) scale(0); 
                }
                to { 
                    opacity: 1; 
                    transform: translateY(-50%) scale(1); 
                }
            }
            
            @keyframes colorPulse {
                0% { transform: scale(0); opacity: 0; }
                50% { transform: scale(1.2); opacity: 1; }
                100% { transform: scale(1); opacity: 0; }
            }
        `;
        document.head.appendChild(checkmarkStyle);

        // --- Combined Form Click Handler ---
    document.getElementById('wizardForm').addEventListener('click', function(e) {
            const target = e.target;
            
            if (target.dataset.action === 'next') {
                // Add animation
                target.style.transform = 'scale(0.95)';
                const originalBackground = target.style.background;
                target.style.background = '#2a9ee0';
                target.innerHTML = '✓ Processing...';
                
                setTimeout(() => {
                    target.style.transform = 'scale(1)';
                    target.style.background = originalBackground;
                    target.innerHTML = 'Continue';
                    nextStep();
                }, 500);
                return;
            }
            
            if (target.dataset.action === 'back') {
                prevStep();
                return;
            }
            
            if (target.dataset.action === 'reset') {
                // Reset wizard state
                resetWizard();
                return;
            }
            
            if (target.dataset.action === 'download') {
                const dataStr = JSON.stringify(formData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `website-vision-${formData.businessName ? formData.businessName.replace(/[^a-zA-Z0-9]/g, '-') : 'summary'}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show download success feedback
                target.innerHTML = '<i class="fas fa-check mr-2"></i>Downloaded!';
                setTimeout(() => {
                    target.innerHTML = '<i class="fas fa-download mr-2"></i>Download Summary';
                }, 2000);
                return;
            }
            
            if (target.dataset.action === 'submit') {
                // Show loading state
                target.disabled = true;
                target.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Submitting...';
                
                // Trigger confetti animation
                triggerConfetti();
                
                // Submit to Formspree
                const form = document.createElement('form');
                form.action = 'https://formspree.io/f/your-form-id'; // TODO: Replace with your Formspree endpoint
                form.method = 'POST';
                form.style.display = 'none';
                
                // Add form data
                for (const key in formData) {
                    if (formData.hasOwnProperty(key)) {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = typeof formData[key] === 'object' ? JSON.stringify(formData[key]) : formData[key];
                        form.appendChild(input);
                    }
                }
                
                // Add email copy if requested
                if (formData.sendEmailCopy && formData.email) {
                    const cc = document.createElement('input');
                    cc.type = 'hidden';
                    cc.name = '_cc';
                    cc.value = formData.email;
                    form.appendChild(cc);
                }
                
                // Add subject line
                const subject = document.createElement('input');
                subject.type = 'hidden';
                subject.name = '_subject';
                subject.value = `Website Vision Builder - ${formData.businessName || 'New Project'}`;
                form.appendChild(subject);
                
                document.body.appendChild(form);
                
                // Simulate form submission (replace with actual form.submit() when Formspree is configured)
                setTimeout(() => {
                    form.remove();
                    showSuccessMessage();
                    
                    // Reset button
                    target.disabled = false;
                    target.innerHTML = '<i class="fas fa-check mr-2"></i>Submitted Successfully!';
                    
                    // Clear localStorage after successful submission
                    localStorage.removeItem('websiteVisionBuilderData');
                }, 2000);
                
                return;
            }
        });

        // --- Real-time Progress Tracking ---
        function updateProgressIndicator() {
            const totalFields = 8; // Total number of form sections
            let completedFields = 0;
            
            // Check each section for completion
            if (formData.businessType) completedFields++;
            if (formData.goals && formData.goals.length > 0) completedFields++;
            if (formData.pagesCore && formData.pagesCore.length > 0) completedFields++;
            if (formData.pagesTrust && formData.pagesTrust.length > 0) completedFields++;
            if (formData.pagesEngage && formData.pagesEngage.length > 0) completedFields++;
            if (formData.pagesCommerce && formData.pagesCommerce.length > 0) completedFields++;
            if (formData.features && formData.features.length > 0) completedFields++;
            if (formData.designStyle) completedFields++;
            if (formData.primaryColor) completedFields++;
            
            const progressPercentage = Math.min((completedFields / totalFields) * 100, 100);
            
            // Update progress bar
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = `${progressPercentage}%`;
                progressBar.style.transition = 'width 0.5s ease';
            }
            
            // Add completion celebration
            if (progressPercentage === 100) {
                addCompletionCelebration();
            }
        }
        
        // --- Add Completion Celebration ---
        function addCompletionCelebration() {
            const preview = document.getElementById('sitePreview');
            const previewContent = preview.querySelector('.preview-content');
            
            // Create celebration overlay
            const celebration = document.createElement('div');
            celebration.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(58, 187, 250, 0.9), rgba(42, 158, 224, 0.9));
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                animation: celebrationIn 0.5s ease;
            `;
            
            celebration.innerHTML = `
                <div style="text-align: center; color: white;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🎉</div>
                    <h3 style="font-size: 24px; margin-bottom: 8px;">Perfect!</h3>
                    <p style="font-size: 16px; opacity: 0.9;">Your site configuration is complete!</p>
                </div>
            `;
            
            previewContent.style.position = 'relative';
            previewContent.appendChild(celebration);
            
            setTimeout(() => {
                celebration.style.animation = 'celebrationOut 0.5s ease';
                setTimeout(() => {
                    celebration.remove();
                }, 500);
            }, 2000);
        }
        
        // --- Confetti Animation ---
        function triggerConfetti() {
            const colors = ['#3abbfa', '#f39c12', '#2ecc71', '#e74c3c', '#9b59b6'];
            const confettiCount = 200;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        top: -10px;
                        left: ${Math.random() * 100}vw;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 9999;
                        animation: confettiFall 3s linear forwards;
                    `;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 10);
            }
        }
        
        // --- Success Message ---
        function showSuccessMessage() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            overlay.innerHTML = `
                <div class="bg-dark-light border border-primary rounded-xl p-8 max-w-md mx-4 text-center">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-full mb-4">
                        <i class="fas fa-check text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-2">Thank You!</h3>
                    <p class="text-text-muted mb-6">Your website vision has been submitted successfully. We'll get back to you with a custom proposal within 24 hours.</p>
                    <button onclick="this.closest('.fixed').remove()" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }
        
        // Add celebration and confetti animations
        const celebrationStyle = document.createElement('style');
        celebrationStyle.textContent = `
            @keyframes celebrationIn {
                from { 
                    opacity: 0; 
                    transform: scale(0.8); 
                }
                to { 
                    opacity: 1; 
                    transform: scale(1); 
                }
            }
            
            @keyframes celebrationOut {
                from { 
                    opacity: 1; 
                    transform: scale(1); 
                }
                to { 
                    opacity: 0; 
                    transform: scale(0.8); 
                }
            }
            
            @keyframes confettiFall {
                0% {
                    transform: translateY(-10px) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
        `;
        document.head.appendChild(celebrationStyle);
        
    // --- Initial Render ---
        initializeFormData();
        renderStep(currentStep);
        updatePreviewVisibility();
        
        // Update progress on form changes
        document.getElementById('wizardForm').addEventListener('input', function() {
            updateProgressIndicator();
        });

        // Handle business type selection
        document.getElementById('wizardForm').addEventListener('change', function(e) {
            const t = e.target;
            if (t.type === 'radio' && t.name === 'businessType') {
                formData[t.name] = t.value;
                updatePreview();
            }
        });

        // --- Preview Wireframe Renderers ---
        const previewBusinessTypes = {
          'service-business': renderServiceBusinessPreview,
          'trades': renderTradesPreview,
          'consulting': renderConsultingPreview,
          'education': renderEducationPreview,
          'real-estate-agency': renderRealEstatePreview,
          'other': renderOtherPreview
        };

        function renderServiceBusinessPreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          // Only these features should render visible blocks
          const features = (state.features && Array.isArray(state.features)) ? state.features : (formData.features || []);
          let analyticsSection = '';
          let newsletterSection = '';
          let liveChatSection = '';
          let socialSection = '';
          // Analytics block
          if (features.includes('Analytics')) {
            analyticsSection = `<div class="w-full max-w-6xl mx-auto px-6 py-8 bg-white rounded-xl shadow feature-section">
              <section class="feature-block">
                <h4 class="font-bold text-lg mb-4 text-blue-700 flex items-center justify-center gap-2"><i class="fas fa-chart-bar"></i> Analytics Dashboard</h4>
                <div class="flex flex-wrap justify-center gap-6">
                  <div class="bg-white rounded-lg p-4 min-w-[120px] shadow-sm">
                    <div class="text-2xl font-bold text-blue-700 mb-1">1.2K</div>
                    <div class="text-xs text-gray-500">Monthly Visitors</div>
                  </div>
                  <div class="bg-white rounded-lg p-4 min-w-[120px] shadow-sm">
                    <div class="text-2xl font-bold text-blue-700 mb-1">85%</div>
                    <div class="text-xs text-gray-500">Conversion Rate</div>
                  </div>
                  <div class="bg-white rounded-lg p-4 min-w-[120px] shadow-sm">
                    <div class="text-2xl font-bold text-blue-700 mb-1">$12K</div>
                    <div class="text-xs text-gray-500">Monthly Revenue</div>
                  </div>
                </div>
              </section>
            </div>`;
          }
          // Newsletter block
          if (features.includes('Newsletter Signup')) {
            newsletterSection = `<div class="w-full max-w-6xl mx-auto px-6 py-8 bg-white rounded-xl shadow feature-section">
              <section class="feature-block">
                <label class="flex items-center justify-center gap-2 mb-2 text-blue-700 font-semibold text-base"><i class="fas fa-envelope"></i> Stay Updated</label>
                <div class="text-xs text-gray-500 mb-3">Get the latest updates and exclusive offers!</div>
                <form class="feature-newsletter-form">
                  <input type="email" placeholder="Enter your email" />
                  <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
                </form>
              </section>
            </div>`;
          }
          // Live Chat block
          if (features.includes('Live Chat')) {
            liveChatSection = `<div class="w-full max-w-6xl mx-auto px-6 py-8 bg-white rounded-xl shadow feature-section">
              <section class="feature-block">
                <div class="feature-chat-row">
                  <span class="feature-chat-label"><i class="fas fa-comments"></i> Live Chat Support</span>
                  <button><i class="fas fa-comment-dots"></i> Start Chat</button>
                </div>
                <div class="text-xs text-gray-500 mt-2">Chat with us instantly for help!</div>
              </section>
            </div>`;
          }
          // Social Media Integration block
          if (features.includes('Social Media Integration')) {
            socialSection = `<div class="w-full max-w-6xl mx-auto px-6 py-8 bg-white rounded-xl shadow feature-section">
              <section class="feature-block">
                <div class="font-bold text-indigo-700 text-base mb-1">Follow Us</div>
                <div class="feature-social-icons">
                  <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                  <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                  <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                  <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
              </section>
            </div>`;
          }
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-blue-700 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Service Business'}</h1>
                  <p class="text-sm opacity-80">Professional Services</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-blue-50 to-blue-100">
                <h2 class="text-2xl font-bold mb-2">Expert Solutions for Your Business</h2>
                <p class="mb-6 text-gray-600">We help you focus on what matters most.</p>
                <button class="bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700 transition">Request Consultation</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">💼</span>
                  <h3 class="font-semibold mb-1">Advisory</h3>
                  <p class="text-xs text-gray-500 text-center">Strategic business advice for growth.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📑</span>
                  <h3 class="font-semibold mb-1">Compliance</h3>
                  <p class="text-xs text-gray-500 text-center">Stay ahead of regulations and risk.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🤝</span>
                  <h3 class="font-semibold mb-1">Client Relations</h3>
                  <p class="text-xs text-gray-500 text-center">Build trust and long-term partnerships.</p>
                </div>
              </main>
              ${trust}
              ${analyticsSection}
              ${newsletterSection}
              ${liveChatSection}
              ${socialSection}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: info@example.com | (555) 123-4567</div>
                <div class="mt-1">&copy; 2024 Service Business. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        function renderTradesPreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-yellow-700 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Trades Company'}</h1>
                  <p class="text-sm opacity-80">Construction & Skilled Trades</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-yellow-50 to-yellow-100">
                <h2 class="text-2xl font-bold mb-2">Quality Work. Trusted Results.</h2>
                <p class="mb-6 text-gray-600">Licensed, insured, and ready to help.</p>
                <button class="bg-yellow-600 text-white px-6 py-2 rounded shadow hover:bg-yellow-700 transition">Request a Quote</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🔨</span>
                  <h3 class="font-semibold mb-1">Repairs</h3>
                  <p class="text-xs text-gray-500 text-center">Fast, reliable home and business repairs.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🧰</span>
                  <h3 class="font-semibold mb-1">Installations</h3>
                  <p class="text-xs text-gray-500 text-center">Professional installations, every time.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">⚡</span>
                  <h3 class="font-semibold mb-1">Emergency</h3>
                  <p class="text-xs text-gray-500 text-center">24/7 emergency service available.</p>
                </div>
              </main>
              ${trust}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: info@trades.com | (555) 987-6543</div>
                <div class="mt-1">&copy; 2024 Trades Company. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        function renderConsultingPreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-purple-800 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Consulting Firm'}</h1>
                  <p class="text-sm opacity-80">Business Consulting</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-purple-50 to-purple-100">
                <h2 class="text-2xl font-bold mb-2">Unlock Your Business Potential</h2>
                <p class="mb-6 text-gray-600">Strategy, growth, and transformation.</p>
                <button class="bg-purple-700 text-white px-6 py-2 rounded shadow hover:bg-purple-900 transition">Book a Strategy Call</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📈</span>
                  <h3 class="font-semibold mb-1">Growth</h3>
                  <p class="text-xs text-gray-500 text-center">Data-driven growth strategies.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🤔</span>
                  <h3 class="font-semibold mb-1">Problem Solving</h3>
                  <p class="text-xs text-gray-500 text-center">Solutions for your toughest challenges.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">💡</span>
                  <h3 class="font-semibold mb-1">Innovation</h3>
                  <p class="text-xs text-gray-500 text-center">Modernize and transform your business.</p>
                </div>
              </main>
              ${trust}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: hello@consulting.com | (555) 222-3333</div>
                <div class="mt-1">&copy; 2024 Consulting Firm. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        function renderEducationPreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-green-700 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Education Center'}</h1>
                  <p class="text-sm opacity-80">Learning & Growth</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-green-50 to-green-100">
                <h2 class="text-2xl font-bold mb-2">Empowering Minds, Building Futures</h2>
                <p class="mb-6 text-gray-600">Flexible courses for every learner.</p>
                <button class="bg-green-600 text-white px-6 py-2 rounded shadow hover:bg-green-700 transition">Register Now</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📚</span>
                  <h3 class="font-semibold mb-1">Courses</h3>
                  <p class="text-xs text-gray-500 text-center">Wide range of subjects and skills.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🧑‍🏫</span>
                  <h3 class="font-semibold mb-1">Expert Instructors</h3>
                  <p class="text-xs text-gray-500 text-center">Learn from the best in the field.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🎓</span>
                  <h3 class="font-semibold mb-1">Certifications</h3>
                  <p class="text-xs text-gray-500 text-center">Earn credentials for your future.</p>
                </div>
              </main>
              ${trust}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: info@education.com | (555) 444-5555</div>
                <div class="mt-1">&copy; 2024 Education Center. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        function renderRealEstatePreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-indigo-700 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Real Estate Agency'}</h1>
                  <p class="text-sm opacity-80">Find Your Dream Home</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-indigo-50 to-indigo-100">
                <h2 class="text-2xl font-bold mb-2">Featured Properties</h2>
                <p class="mb-6 text-gray-600">Browse our latest listings and agents.</p>
                <button class="bg-indigo-600 text-white px-6 py-2 rounded shadow hover:bg-indigo-700 transition">View Listings</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🏡</span>
                  <h3 class="font-semibold mb-1">Modern Home</h3>
                  <p class="text-xs text-gray-500 text-center">3 bed, 2 bath, 1,800 sqft</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">🏢</span>
                  <h3 class="font-semibold mb-1">Downtown Condo</h3>
                  <p class="text-xs text-gray-500 text-center">2 bed, 1 bath, city view</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">👨‍💼</span>
                  <h3 class="font-semibold mb-1">Top Agent</h3>
                  <p class="text-xs text-gray-500 text-center">Meet our experienced team.</p>
                </div>
              </main>
              ${trust}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: info@realestate.com | (555) 666-7777</div>
                <div class="mt-1">&copy; 2024 Real Estate Agency. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        function renderOtherPreview(state) {
          const nav = renderPreviewNav(state);
          const trust = renderTrustSections(state);
          return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden text-gray-800">
              <header class="bg-gray-700 text-white px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h1 class="text-xl font-bold tracking-tight">${state.businessName || 'Your Business'}</h1>
                  <p class="text-sm opacity-80">Professional Website</p>
                </div>
                ${nav}
              </header>
              <section class="px-6 py-10 text-center bg-gradient-to-br from-gray-50 to-gray-100">
                <h2 class="text-2xl font-bold mb-2">Welcome to Your New Website</h2>
                <p class="mb-6 text-gray-600">A clean, modern starting point for any business.</p>
                <button class="bg-gray-600 text-white px-6 py-2 rounded shadow hover:bg-gray-700 transition">Contact Us</button>
              </section>
              <main class="px-6 py-8 grid gap-6 md:grid-cols-3">
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📦</span>
                  <h3 class="font-semibold mb-1">Feature One</h3>
                  <p class="text-xs text-gray-500 text-center">Describe your first feature here.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📦</span>
                  <h3 class="font-semibold mb-1">Feature Two</h3>
                  <p class="text-xs text-gray-500 text-center">Describe your second feature here.</p>
                </div>
                <div class="bg-white border rounded-lg p-4 flex flex-col items-center">
                  <span class="text-3xl mb-2">📦</span>
                  <h3 class="font-semibold mb-1">Feature Three</h3>
                  <p class="text-xs text-gray-500 text-center">Describe your third feature here.</p>
                </div>
              </main>
              ${trust}
              <footer class="bg-gray-100 text-xs text-gray-500 text-center py-4">
                <div>Contact: info@yourbusiness.com | (555) 000-1111</div>
                <div class="mt-1">&copy; 2024 Your Business. All rights reserved.</div>
              </footer>
            </div>
          `;
        }

        // --- Dynamic Nav and Trust Sections ---
        function renderPreviewNav(state) {
          // Only show the pages that are checked in selectedPages.core, in the correct order
          const coreOrder = ['Home', 'About', 'Services', 'Contact'];
          let navItems = [];
          // Always treat pagesCore as an array
          const pagesCore = Array.isArray(state.pagesCore) ? state.pagesCore : [];
          navItems = coreOrder.filter(page => pagesCore.includes(page));
          return `<nav class=\"flex gap-4 mt-2 md:mt-0\">${navItems.map(item => `<span class=\"px-3 py-1 rounded bg-white/10 text-white text-sm font-medium\">${item}</span>`).join('')}</nav>`;
        }

        function renderTrustSections(state) {
          let html = '';
          if (state.pagesTrust && state.pagesTrust.includes('Testimonials')) {
            html += `<section class="my-6 mx-4 bg-white rounded-lg shadow p-6 flex items-start gap-4">
              <span class="text-yellow-400 text-2xl"><i class="fas fa-star"></i></span>
              <div>
                <h4 class="font-bold text-lg mb-1 text-gray-800">Testimonials</h4>
                <blockquote class="italic text-gray-600">"Great service! Highly recommend."<br><span class="text-xs text-gray-400">- Satisfied Client</span></blockquote>
              </div>
            </section>`;
          }
          if (state.pagesTrust && state.pagesTrust.includes('FAQ')) {
            html += `<section class="my-6 mx-4 bg-white rounded-lg shadow p-6 flex items-start gap-4">
              <span class="text-blue-400 text-2xl"><i class="fas fa-question-circle"></i></span>
              <div>
                <h4 class="font-bold text-lg mb-1 text-gray-800">FAQ</h4>
                <ul class="text-sm text-gray-600">
                  <li><span class="font-semibold">Q:</span> How do I get started?<br><span class="font-semibold">A:</span> Contact us for a free consultation.</li>
                </ul>
              </div>
            </section>`;
          }
          if (state.pagesTrust && state.pagesTrust.includes('Case Studies')) {
            html += `<section class="my-6 mx-4 bg-white rounded-lg shadow p-6 flex items-start gap-4">
              <span class="text-green-500 text-2xl"><i class="fas fa-folder-open"></i></span>
              <div>
                <h4 class="font-bold text-lg mb-1 text-gray-800">Case Studies</h4>
                <p class="text-sm text-gray-600">See how we've helped clients succeed with real-world examples.</p>
              </div>
            </section>`;
          }
          if (state.pagesTrust && state.pagesTrust.includes('Team')) {
            html += `<section class="my-6 mx-4 bg-white rounded-lg shadow p-6 flex items-start gap-4">
              <span class="text-indigo-500 text-2xl"><i class="fas fa-users"></i></span>
              <div>
                <h4 class="font-bold text-lg mb-1 text-gray-800">Our Team</h4>
                <div class="flex gap-2 mt-2">
                  <span class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"><i class="fas fa-user"></i></span>
                  <span class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"><i class="fas fa-user"></i></span>
                  <span class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"><i class="fas fa-user"></i></span>
                </div>
              </div>
            </section>`;
          }
          return html;
        }

        // --- Step 4 Selected Pages State ---
        let selectedPages = {
          core: [],
          trust: []
        };

        // --- Update selectedPages on Step 4 changes ---
        function updateSelectedPagesFromFormData() {
          selectedPages.core = Array.isArray(formData.pagesCore) ? [...formData.pagesCore] : [];
          selectedPages.trust = Array.isArray(formData.pagesTrust) ? [...formData.pagesTrust] : [];
        }



        // --- Patch: Always update selectedPages before preview ---
        function updatePreview() {
          updateSelectedPagesFromFormData();
          
          if (!previewEnabled) {
            return;
          }
          
          const preview = document.getElementById('sitePreview');
          const previewContent = preview.querySelector('.preview-content');
          const details = preview.querySelector('.preview-details');
          
          if (!previewContent) {
            console.error('No .preview-content element found!');
            return;
          }
          
          if (!formData.businessType) {
            previewContent.innerHTML = `
              <div class="flex items-center justify-center h-full text-gray-500">
                <div class="text-center">
                  <div class="text-4xl mb-4">🎨</div>
                  <p>Select a business type to see your preview</p>
                </div>
              </div>
            `;
            if (details) details.innerHTML = '<p>No business type selected</p>';
          } else {
            try {
              // Always treat pagesCore and pagesTrust as arrays
              const safePagesCore = Array.isArray(selectedPages.core) ? selectedPages.core : [];
              const safePagesTrust = Array.isArray(selectedPages.trust) ? selectedPages.trust : [];
              if (previewBusinessTypes[formData.businessType]) {
                previewContent.innerHTML = previewBusinessTypes[formData.businessType]({
                  businessName: formData.businessName || '',
                  selectedPages,
                  pagesCore: safePagesCore,
                  pagesTrust: safePagesTrust
                });
              } else {
                // fallback to service business
                previewContent.innerHTML = renderServiceBusinessPreview({
                  businessName: formData.businessName || 'Service Business',
                  selectedPages,
                  pagesCore: safePagesCore,
                  pagesTrust: safePagesTrust
                });
              }
            } catch (e) {
              console.error('Preview update failed:', e);
              previewContent.innerHTML = '<div class="text-red-600">Preview rendering failed. Check console for details.</div>';
            }
            
            // Update details
            let detailsHTML = `<p><strong>Business Type:</strong> ${formData.businessType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>`;
            if (formData.goals && formData.goals.length > 0) {
              detailsHTML += `<p><strong>Goals:</strong> ${formData.goals.join(', ')}</p>`;
            }
            if (selectedPages.core && selectedPages.core.length > 0) {
              detailsHTML += `<p><strong>Core Pages:</strong> ${selectedPages.core.join(', ')}</p>`;
            }
            if (selectedPages.trust && selectedPages.trust.length > 0) {
              detailsHTML += `<p><strong>Trust Pages:</strong> ${selectedPages.trust.join(', ')}</p>`;
            }
            if (details) details.innerHTML = detailsHTML;
          }
        }


    </script>
</body>
</html> 